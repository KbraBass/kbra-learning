<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â¡Aprende el Calendario! - Conceptos de Tiempo</title>
    
    <!-- Shared CSS -->
    <link rel="stylesheet" href="../../css/core.css">
    <link rel="stylesheet" href="../../css/components.css">
    
    <style>
        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 30px auto;
            max-width: 700px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-month {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-name {
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
            padding: 10px 5px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(78, 205, 196, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-day:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }
        
        .calendar-day.today {
            background: var(--accent-color);
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }
        
        .concepts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .concept-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .concept-card h3 {
            color: var(--primary-color);
            margin-top: 0;
        }
        
        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .month-card {
            background: white;
            border: 3px solid var(--primary-color);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .month-card:hover {
            transform: translateY(-5px);
        }
        
        .month-name {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .month-days {
            color: var(--accent-color);
            margin-top: 5px;
        }
        
        .date-calculator {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .glossary-term {
            background: white;
            border-left: 5px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .glossary-term h3 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
        }
        
        .symbol-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .symbol-display {
            font-size: 4em;
            color: var(--primary-color);
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="header-container"></div>
        <div id="tabs-container"></div>

        <!-- GLOSARIO TAB -->
        <div id="glosario" class="content tab-content active">
            <h2 class="section-title">ğŸ“– Glosario de Calendario</h2>
            
            <div class="explanation">
                <p>Aprende los tÃ©rminos clave relacionados con el calendario y el tiempo:</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”µ Calendario</h3>
                <p><strong>DefiniciÃ³n:</strong> Sistema de organizaciÃ³n del tiempo en dÃ­as, semanas, meses y aÃ±os. Nos ayuda a planificar y recordar fechas importantes.</p>
                <p><strong>Ejemplo:</strong> "El calendario escolar muestra que las vacaciones de verano empiezan el 22 de junio."</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”µ Mes</h3>
                <p><strong>DefiniciÃ³n:</strong> DivisiÃ³n del aÃ±o que originalmente se basaba en el ciclo lunar. Un aÃ±o tiene 12 meses con diferentes cantidades de dÃ­as (28-31).</p>
                <p><strong>Ejemplo:</strong> "Mi cumpleaÃ±os es en el mes de abril."</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”µ Semana</h3>
                <p><strong>DefiniciÃ³n:</strong> PerÃ­odo de 7 dÃ­as consecutivos que se repite continuamente. Va de lunes a domingo en la mayorÃ­a de calendarios.</p>
                <p><strong>Ejemplo:</strong> "Esta semana tenemos examen el jueves."</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”µ AÃ±o Bisiesto</h3>
                <p><strong>DefiniciÃ³n:</strong> AÃ±o que tiene 366 dÃ­as en lugar de 365. Ocurre cada 4 aÃ±os y febrero tiene 29 dÃ­as en vez de 28.</p>
                <p><strong>Ejemplo:</strong> "2024 es un aÃ±o bisiesto, por eso febrero tuvo 29 dÃ­as."</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”µ Festivo</h3>
                <p><strong>DefiniciÃ³n:</strong> DÃ­a especial en el que se celebra algo importante y generalmente no se trabaja ni se va a la escuela.</p>
                <p><strong>Ejemplo:</strong> "El 25 de diciembre es un dÃ­a festivo: Â¡Navidad!"</p>
            </div>
        </div>

        <!-- SÃMBOLOS TAB -->
        <div id="simbolos" class="content tab-content">
            <h2 class="section-title">ğŸ”£ SÃ­mbolos del Calendario</h2>
            
            <div class="explanation">
                <p>Aprende los sÃ­mbolos y notaciones que usamos para escribir fechas:</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">ğŸ“…</div>
                <h3>Calendario</h3>
                <p><strong>Uso:</strong> Representa un calendario o una fecha</p>
                <p><strong>Ejemplo:</strong> "Abre el ğŸ“… para ver quÃ© dÃ­a es hoy"</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">/</div>
                <h3>Barra (Separador de fecha)</h3>
                <p><strong>Uso:</strong> Separa el dÃ­a, mes y aÃ±o en una fecha</p>
                <p><strong>Ejemplo:</strong> "27/11/2025" (dÃ­a/mes/aÃ±o)</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">-</div>
                <h3>Guion (Separador alternativo)</h3>
                <p><strong>Uso:</strong> TambiÃ©n se usa para separar partes de una fecha</p>
                <p><strong>Ejemplo:</strong> "2025-11-27" (formato ISO: aÃ±o-mes-dÃ­a)</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">D/M/A</div>
                <h3>Formato EspaÃ±ol</h3>
                <p><strong>Uso:</strong> En EspaÃ±a usamos dÃ­a/mes/aÃ±o</p>
                <p><strong>Ejemplo:</strong> "15/08/2025" = 15 de agosto de 2025</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">ğŸ”„</div>
                <h3>RepeticiÃ³n/Ciclo</h3>
                <p><strong>Uso:</strong> Indica eventos que se repiten</p>
                <p><strong>Ejemplo:</strong> "ğŸ”„ Cada lunes" = Se repite todos los lunes</p>
            </div>
        </div>

        <!-- INTRODUCCIÃ“N TAB -->
        <div id="introduccion" class="content tab-content">
            <h2 class="section-title">ğŸ“š IntroducciÃ³n al Calendario</h2>
            
            <div class="explanation">
                <h3>Â¿Por quÃ© es importante el calendario?</h3>
                <p>El calendario es una herramienta fundamental en nuestra vida diaria que nos ayuda a:</p>
                <ul>
                    <li><strong>Organizar</strong> nuestras actividades y compromisos</li>
                    <li><strong>Recordar</strong> fechas importantes como cumpleaÃ±os y festivos</li>
                    <li><strong>Planificar</strong> eventos futuros como viajes o exÃ¡menes</li>
                    <li><strong>Coordinar</strong> reuniones y citas con otras personas</li>
                    <li><strong>Entender</strong> ciclos naturales como las estaciones</li>
                </ul>
            </div>

            <div class="concepts-grid">
                <div class="concept-card">
                    <h3>ğŸ« En la Escuela</h3>
                    <p>Los calendarios escolares marcan:</p>
                    <ul>
                        <li>DÃ­as de clase y vacaciones</li>
                        <li>Fechas de exÃ¡menes</li>
                        <li>Entregas de trabajos</li>
                        <li>Eventos y excursiones</li>
                    </ul>
                </div>
                
                <div class="concept-card">
                    <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ En Familia</h3>
                    <p>Las familias usan calendarios para:</p>
                    <ul>
                        <li>Recordar cumpleaÃ±os</li>
                        <li>Planificar vacaciones</li>
                        <li>Programar visitas mÃ©dicas</li>
                        <li>Organizar celebraciones</li>
                    </ul>
                </div>
                
                <div class="concept-card">
                    <h3>âš½ En Deportes</h3>
                    <p>Los calendarios deportivos incluyen:</p>
                    <ul>
                        <li>Fechas de partidos</li>
                        <li>Torneos y campeonatos</li>
                        <li>Entrenamientos especiales</li>
                        <li>Temporadas deportivas</li>
                    </ul>
                </div>
                
                <div class="concept-card">
                    <h3>ğŸ‰ Celebraciones</h3>
                    <p>DÃ­as festivos importantes:</p>
                    <ul>
                        <li>AÃ±o Nuevo (1 enero)</li>
                        <li>Reyes Magos (6 enero)</li>
                        <li>Semana Santa (marzo/abril)</li>
                        <li>Navidad (25 diciembre)</li>
                    </ul>
                </div>
            </div>

            <div class="fun-facts">
                <h3>ğŸ“† Datos Curiosos:</h3>
                <ul>
                    <li>El calendario que usamos se llama <strong>Gregoriano</strong> y fue introducido por el Papa Gregorio XIII en 1582</li>
                    <li>Los nombres de los meses vienen del latÃ­n y algunos honran a emperadores romanos</li>
                    <li>Septiembre, octubre, noviembre y diciembre significan 7Âº, 8Âº, 9Âº y 10Âº mes, Â¡pero ahora son el 9Âº, 10Âº, 11Âº y 12Âº!</li>
                    <li>No todos los paÃ­ses usan el mismo calendario: algunos usan calendarios lunares</li>
                </ul>
            </div>
        </div>

        <!-- TEORÃA TAB -->
        <div id="teoria" class="content tab-content">
            <h2 class="section-title">ğŸ“… El Calendario Interactivo</h2>
            
            <div class="explanation">
                <h3>Explora el calendario</h3>
                <p>Usa los botones para navegar entre meses y descubre la estructura del calendario.</p>
            </div>

            <div class="calendar-container">
                <div class="calendar-header">
                    <button onclick="previousMonth()" class="primary-button">â† Anterior</button>
                    <div class="calendar-month" id="current-month"></div>
                    <button onclick="nextMonth()" class="primary-button">Siguiente â†’</button>
                </div>
                <div class="calendar-grid" id="calendar"></div>
            </div>

            <div class="fun-facts">
                <h3>ğŸ“† Datos del Calendario:</h3>
                <ul>
                    <li>Un aÃ±o tiene <strong>365 dÃ­as</strong> (366 en aÃ±os bisiestos)</li>
                    <li>Un aÃ±o tiene <strong>12 meses</strong></li>
                    <li>Una semana tiene <strong>7 dÃ­as</strong></li>
                    <li>Un dÃ­a tiene <strong>24 horas</strong></li>
                </ul>
            </div>

            <h3 class="text-center">Los 12 Meses del AÃ±o</h3>
            
            <div class="months-grid">
                <div class="month-card"><div class="month-name">Enero</div><div class="month-days">31 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Febrero</div><div class="month-days">28/29 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Marzo</div><div class="month-days">31 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Abril</div><div class="month-days">30 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Mayo</div><div class="month-days">31 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Junio</div><div class="month-days">30 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Julio</div><div class="month-days">31 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Agosto</div><div class="month-days">31 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Septiembre</div><div class="month-days">30 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Octubre</div><div class="month-days">31 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Noviembre</div><div class="month-days">30 dÃ­as</div></div>
                <div class="month-card"><div class="month-name">Diciembre</div><div class="month-days">31 dÃ­as</div></div>
            </div>

            <div class="date-calculator">
                <h3>Â¿CuÃ¡ntos dÃ­as faltan?</h3>
                <div class="input-section">
                    <div class="input-group">
                        <label for="target-date">Selecciona una fecha:</label>
                        <input type="date" id="target-date">
                    </div>
                    <button class="calc-button" onclick="calculateDaysUntil()">Calcular</button>
                    <div class="result" id="date-result"></div>
                </div>
            </div>

            <div class="date-calculator">
                <h3>Â¿QuÃ© dÃ­a de la semana es?</h3>
                <div class="input-section">
                    <div class="input-group">
                        <label for="weekday-date">Selecciona una fecha:</label>
                        <input type="date" id="weekday-date">
                    </div>
                    <button class="calc-button" onclick="findWeekday()">Descubrir</button>
                    <div class="result" id="weekday-result"></div>
                </div>
            </div>
        </div>

        <!-- ENTRENAMIENTO TAB -->
        <div id="entrenamiento" class="content tab-content">
            <h2 class="section-title">ğŸ† Entrenamiento</h2>
            
            <div class="practice-area">
                <div id="score-container"></div>

                <h3 class="header-with-color" id="practice-question">Haz clic en "Nueva Pregunta" para empezar</h3>
                
                <div id="practice-visual" class="result-container"></div>

                <div class="input-section">
                    <div class="input-group">
                        <label for="practice-answer">Tu respuesta:</label>
                        <input type="text" id="practice-answer" placeholder="?" onkeypress="if(event.key==='Enter') checkAnswer()">
                    </div>
                    <button class="calc-button" id="check-button" onclick="checkAnswer()">âœ… Comprobar</button>
                    <button class="calc-button" onclick="generateQuestion()">ğŸ”„ Nueva Pregunta</button>
                    <div class="result" id="practice-result">Â¡Genera una pregunta para empezar!</div>
                </div>
            </div>

            <div class="fun-facts">
                <h3>ğŸ’¡ Consejos:</h3>
                <ul>
                    <li>Aprende el orden de los meses y sus dÃ­as</li>
                    <li>Recuerda: "30 dÃ­as trae septiembre, abril, junio y noviembre"</li>
                    <li>Los dÃ­as de la semana siempre van en el mismo orden</li>
                    <li>Los meses con 31 dÃ­as son: enero, marzo, mayo, julio, agosto, octubre y diciembre</li>
                </ul>
            </div>
        </div>

        <!-- EXAMEN FINAL TAB -->
        <div id="examen-final" class="content tab-content">
            <h2 class="section-title">ğŸ“ Examen Final de Calendario</h2>
            
            <div class="explanation">
                <p>Completa este examen para demostrar tu dominio del calendario.</p>
                <p><strong>Requisitos:</strong> 70% o mÃ¡s para aprobar (14/20 respuestas correctas)</p>
                <p><strong>Recompensa:</strong> ObtÃ©n el trofeo "Maestro del Calendario" ğŸ†</p>
            </div>

            <div class="exam-container">
                <div id="exam-progress"></div>
                <div id="exam-question-container"></div>
                <div id="exam-result" style="display: none;"></div>
                <button class="primary-button" onclick="startExam()">Comenzar Examen</button>
            </div>
        </div>
    </div>

    <script src="../../lib/storage.js"></script>
    <script src="../../lib/gamification.js"></script>
    <script src="../../lib/components.js"></script>

    <script>
        const MODULE_ID = 'calendario';
        let currentQuestion = null;
        let questionAnswered = false;
        let currentDate = new Date();
        let examQuestions = [];
        let currentExamQuestion = 0;
        let examAnswers = [];
        let examStarted = false;

        const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        const dayNames = ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b'];
        const monthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

        function init() {
            const headerHtml = Components.createHeader(
                'ğŸ“… Â¡Aprende el Calendario! ğŸ“…',
                'Domina los dÃ­as, semanas, meses y aÃ±os',
                '../index.html'
            );
            document.getElementById('header-container').innerHTML = headerHtml;

            const tabs = [
                { id: 'glosario', label: 'Glosario' },
                { id: 'simbolos', label: 'SÃ­mbolos' },
                { id: 'introduccion', label: 'IntroducciÃ³n' },
                { id: 'teoria', label: 'TeorÃ­a' },
                { id: 'entrenamiento', label: 'Entrenamiento' },
                { id: 'examen-final', label: 'Examen Final' }
            ];
            const tabsHtml = Components.createTabs(tabs, 'glosario');
            document.getElementById('tabs-container').innerHTML = tabsHtml;

            const scoreHtml = Components.createScoreDisplay();
            document.getElementById('score-container').innerHTML = scoreHtml;
            
            updateScoreDisplay();
            renderCalendar();
            Storage.updateStreak();
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            
            const tabLabels = {
                'glosario': 'Glosario',
                'simbolos': 'SÃ­mbolos',
                'introduccion': 'IntroducciÃ³n',
                'teoria': 'TeorÃ­a',
                'entrenamiento': 'Entrenamiento',
                'examen-final': 'Examen Final'
            };
            
            document.querySelectorAll('.tab-button').forEach(button => {
                if (button.textContent.includes(tabLabels[tabName])) {
                    button.classList.add('active');
                }
            });
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('current-month').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            let html = '';
            dayNames.forEach(day => {
                html += `<div class="calendar-day-name">${day}</div>`;
            });
            
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day empty"></div>';
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = today.getDate() === day && today.getMonth() === month && today.getFullYear() === year;
                html += `<div class="calendar-day ${isToday ? 'today' : ''}">${day}</div>`;
            }
            
            document.getElementById('calendar').innerHTML = html;
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function calculateDaysUntil() {
            const targetDate = new Date(document.getElementById('target-date').value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            targetDate.setHours(0, 0, 0, 0);
            
            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const result = document.getElementById('date-result');
            if (isNaN(diffDays)) {
                result.textContent = 'Â¡Por favor selecciona una fecha!';
                result.style.background = 'rgba(255, 107, 107, 0.3)';
            } else if (diffDays < 0) {
                result.innerHTML = `<div class="text-dark">Esa fecha ya pasÃ³ hace <strong>${Math.abs(diffDays)} dÃ­as</strong></div>`;
                result.style.background = 'rgba(255, 107, 107, 0.3)';
            } else if (diffDays === 0) {
                result.innerHTML = '<div class="text-dark"><strong>Â¡Es hoy!</strong> ğŸ‰</div>`;
                result.style.background = 'rgba(78, 205, 196, 0.3)';
            } else {
                result.innerHTML = `<div class="text-dark">Faltan <strong>${diffDays} dÃ­as</strong></div>`;
                result.style.background = 'rgba(78, 205, 196, 0.3)';
            }
        }

        function findWeekday() {
            const date = new Date(document.getElementById('weekday-date').value);
            const result = document.getElementById('weekday-result');
            
            if (isNaN(date.getTime())) {
                result.textContent = 'Â¡Por favor selecciona una fecha!';
                result.style.background = 'rgba(255, 107, 107, 0.3)';
            } else {
                const weekdayNames = ['Domingo', 'Lunes', 'Martes', 'MiÃ©rcoles', 'Jueves', 'Viernes', 'SÃ¡bado'];
                const weekday = weekdayNames[date.getDay()];
                result.innerHTML = `<div class="text-dark">Es un <strong>${weekday}</strong></div>`;
                result.style.background = 'rgba(78, 205, 196, 0.3)';
            }
        }

        function generateQuestion() {
            const questions = [
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene una semana?', a: '7' },
                { q: 'Â¿CuÃ¡ntos meses tiene un aÃ±o?', a: '12' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene un aÃ±o normal?', a: '365' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene febrero en un aÃ±o bisiesto?', a: '29' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene enero?', a: '31' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene abril?', a: '30' },
                { q: 'Â¿QuÃ© mes tiene 28 o 29 dÃ­as?', a: 'febrero' },
                { q: 'Â¿CuÃ¡ntas horas tiene un dÃ­a?', a: '24' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene diciembre?', a: '31' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene septiembre?', a: '30' }
            ];
            
            currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            questionAnswered = false;
            
            document.getElementById('practice-question').textContent = currentQuestion.q;
            document.getElementById('practice-visual').innerHTML = '';
            document.getElementById('practice-answer').value = '';
            document.getElementById('practice-result').textContent = 'Â¡Escribe tu respuesta!';
            document.getElementById('practice-result').style.background = 'rgba(255, 255, 255, 0.9)';
            
            const checkButton = document.getElementById('check-button');
            checkButton.disabled = false;
            checkButton.textContent = 'âœ… Comprobar';
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('practice-answer').value.trim().toLowerCase();
            const result = document.getElementById('practice-result');
            
            if (!currentQuestion || questionAnswered) return;
            
            if (!userAnswer) {
                result.textContent = 'Â¡Por favor, escribe una respuesta!';
                result.style.background = 'rgba(255, 107, 107, 0.3)';
                return;
            }
            
            questionAnswered = true;
            const checkButton = document.getElementById('check-button');
            checkButton.disabled = true;
            checkButton.textContent = 'âœ… Respondido';
            
            if (userAnswer === currentQuestion.a.toLowerCase()) {
                Gamification.addPoints(10, MODULE_ID);
                result.innerHTML = `<div class="text-dark">Â¡Correcto! ğŸ‰<br>La respuesta es <strong>${currentQuestion.a}</strong><br><small>+10 puntos</small></div>`;
                result.style.background = 'rgba(78, 205, 196, 0.3)';
            } else {
                Gamification.subtractPoints(5, MODULE_ID);
                result.innerHTML = `<div class="text-dark">Â¡Intenta de nuevo! ğŸ˜Š<br>La respuesta correcta es <strong>${currentQuestion.a}</strong><br><small>-5 puntos</small></div>`;
                result.style.background = 'rgba(255, 107, 107, 0.3)';
            }
            
            updateScoreDisplay();
        }

        function startExam() {
            if (examStarted) {
                if (!confirm('Â¿Quieres reiniciar el examen? PerderÃ¡s tu progreso actual.')) {
                    return;
                }
            }
            
            const allQuestions = [
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene una semana?', a: '7' },
                { q: 'Â¿CuÃ¡ntos meses tiene un aÃ±o?', a: '12' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene un aÃ±o normal?', a: '365' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene un aÃ±o bisiesto?', a: '366' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene febrero en un aÃ±o normal?', a: '28' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene febrero en un aÃ±o bisiesto?', a: '29' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene enero?', a: '31' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene abril?', a: '30' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene diciembre?', a: '31' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene septiembre?', a: '30' },
                { q: 'Â¿CuÃ¡ntas horas tiene un dÃ­a?', a: '24' },
                { q: 'Â¿QuÃ© mes es el primero del aÃ±o?', a: 'enero' },
                { q: 'Â¿QuÃ© mes es el Ãºltimo del aÃ±o?', a: 'diciembre' },
                { q: 'Â¿QuÃ© mes tiene 28 o 29 dÃ­as?', a: 'febrero' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene mayo?', a: '31' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene junio?', a: '30' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene octubre?', a: '31' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene noviembre?', a: '30' },
                { q: 'Â¿QuÃ© mes viene despuÃ©s de enero?', a: 'febrero' },
                { q: 'Â¿QuÃ© mes viene antes de diciembre?', a: 'noviembre' },
                { q: 'Â¿CuÃ¡ntos meses tienen 31 dÃ­as?', a: '7' },
                { q: 'Â¿CuÃ¡ntos meses tienen 30 dÃ­as?', a: '4' },
                { q: 'Â¿En quÃ© mes estÃ¡ la Navidad?', a: 'diciembre' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene agosto?', a: '31' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene julio?', a: '31' },
                { q: 'Â¿QuÃ© mes viene despuÃ©s de febrero?', a: 'marzo' },
                { q: 'Â¿CuÃ¡ntos dÃ­as tiene marzo?', a: '31' },
                { q: 'Â¿Cada cuÃ¡ntos aÃ±os hay un aÃ±o bisiesto?', a: '4' },
                { q: 'Â¿QuÃ© dÃ­a de la semana viene despuÃ©s del domingo?', a: 'lunes' },
                { q: 'Â¿QuÃ© dÃ­a de la semana viene antes del sÃ¡bado?', a: 'viernes' }
            ];
            
            examQuestions = [];
            while (examQuestions.length < 20) {
                const q = allQuestions[Math.floor(Math.random() * allQuestions.length)];
                if (!examQuestions.find(eq => eq.q === q.q)) {
                    examQuestions.push(q);
                }
            }
            
            currentExamQuestion = 0;
            examAnswers = [];
            examStarted = true;
            
            document.querySelector('.exam-container button').style.display = 'none';
            document.getElementById('exam-result').style.display = 'none';
            
            showExamQuestion();
        }

        function showExamQuestion() {
            const container = document.getElementById('exam-question-container');
            const progress = document.getElementById('exam-progress');
            
            progress.innerHTML = `<p>Pregunta ${currentExamQuestion + 1} de ${examQuestions.length}</p>`;
            
            const q = examQuestions[currentExamQuestion];
            container.innerHTML = `
                <div class="explanation">
                    <h3>${q.q}</h3>
                    <div class="input-section">
                        <input type="text" id="exam-answer" placeholder="Tu respuesta" onkeypress="if(event.key==='Enter') submitExamAnswer()">
                        <button class="primary-button" onclick="submitExamAnswer()">Siguiente</button>
                    </div>
                </div>
            `;
            
            document.getElementById('exam-answer').focus();
        }

        function submitExamAnswer() {
            const answer = document.getElementById('exam-answer').value.trim().toLowerCase();
            
            if (!answer) {
                alert('Por favor, escribe una respuesta antes de continuar.');
                return;
            }
            
            const correct = answer === examQuestions[currentExamQuestion].a.toLowerCase();
            examAnswers.push({
                question: examQuestions[currentExamQuestion].q,
                userAnswer: answer,
                correctAnswer: examQuestions[currentExamQuestion].a,
                correct: correct
            });
            
            currentExamQuestion++;
            
            if (currentExamQuestion < examQuestions.length) {
                showExamQuestion();
            } else {
                showExamResults();
            }
        }

        function showExamResults() {
            const container = document.getElementById('exam-question-container');
            const resultDiv = document.getElementById('exam-result');
            const progress = document.getElementById('exam-progress');
            
            container.innerHTML = '';
            progress.innerHTML = '';
            
            const correctCount = examAnswers.filter(a => a.correct).length;
            const percentage = (correctCount / examQuestions.length * 100).toFixed(0);
            const passed = percentage >= 70;
            
            let resultHTML = `
                <div class="explanation ${passed ? 'success' : 'error'}">
                    <h3>${passed ? 'Â¡Felicitaciones! ğŸ‰' : 'Â¡Sigue practicando! ğŸ’ª'}</h3>
                    <p>Obtuviste <strong>${correctCount}</strong> de <strong>${examQuestions.length}</strong> respuestas correctas</p>
                    <p>Porcentaje: <strong>${percentage}%</strong></p>
                    ${passed ? '<p>Â¡Has aprobado el examen!</p>' : '<p>Necesitas al menos 70% para aprobar. Â¡Intenta de nuevo!</p>'}
                </div>
                
                <h3>Resumen de respuestas:</h3>
                <div class="concepts-grid">
            `;
            
            examAnswers.forEach((answer, index) => {
                resultHTML += `
                    <div class="concept-card ${answer.correct ? 'correct-answer' : 'incorrect-answer'}">
                        <h4>Pregunta ${index + 1}</h4>
                        <p><strong>${answer.question}</strong></p>
                        <p>Tu respuesta: ${answer.userAnswer}</p>
                        ${!answer.correct ? `<p>Respuesta correcta: <strong>${answer.correctAnswer}</strong></p>` : '<p>âœ… Correcto</p>'}
                    </div>
                `;
            });
            
            resultHTML += `
                </div>
                <button class="primary-button" onclick="resetExam()">Volver a intentar</button>
            `;
            
            resultDiv.innerHTML = resultHTML;
            resultDiv.style.display = 'block';
            
            if (passed) {
                Storage.completeModule(MODULE_ID, percentage);
                Gamification.awardTrophy('calendario');
                setTimeout(() => {
                    alert('Â¡Felicidades! Has ganado el trofeo "Maestro del Calendario" ğŸ†');
                }, 500);
            }
        }

        function resetExam() {
            examStarted = false;
            document.querySelector('.exam-container button').style.display = 'block';
            document.getElementById('exam-question-container').innerHTML = '';
            document.getElementById('exam-result').style.display = 'none';
            document.getElementById('exam-progress').innerHTML = '';
        }

        function updateScoreDisplay() {
            document.getElementById('score').textContent = Storage.getTotalPoints();
            document.getElementById('level').textContent = Gamification.getCurrentLevel().name;
        }

        init();
    </script>
</body>
</html>
