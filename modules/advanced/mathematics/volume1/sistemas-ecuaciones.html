<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistemas de Ecuaciones - Matem√°ticas Avanzadas</title>
    <link rel="stylesheet" href="../../../../css/core.css">
    <link rel="stylesheet" href="../../../../css/components.css">
</head>
<body>
    <div id="header-container"></div>
    <div id="tabs-container"></div>
    <div id="score-container"></div>

    <div class="container">
        <!-- Tab 1: Glosario -->
        <div class="content-section active" id="glosario">
            <h2>üìñ Glosario de Sistemas de Ecuaciones</h2>
            
            <div class="info-box bg-gradient-primary-white">
                <p>Aprende los t√©rminos clave relacionados con sistemas de ecuaciones lineales:</p>
            </div>

            <div class="definition-card">
                <h3>üî∑ Sistema de Ecuaciones</h3>
                <p><strong>Definici√≥n:</strong> Conjunto de dos o m√°s ecuaciones que comparten las mismas inc√≥gnitas y deben satisfacerse simult√°neamente.</p>
                <p><strong>Ejemplo:</strong> { x + y = 5 ; 2x - y = 1 } es un sistema de 2 ecuaciones con 2 inc√≥gnitas</p>
            </div>

            <div class="definition-card">
                <h3>üî∑ Inc√≥gnita</h3>
                <p><strong>Definici√≥n:</strong> Valor desconocido que se busca determinar. Generalmente representado por letras como x, y, z.</p>
                <p><strong>Ejemplo:</strong> En 3x + 2y = 12, las inc√≥gnitas son x e y</p>
            </div>

            <div class="definition-card">
                <h3>üî∑ Soluci√≥n</h3>
                <p><strong>Definici√≥n:</strong> Conjunto de valores que al sustituirse en las inc√≥gnitas satisfacen todas las ecuaciones del sistema.</p>
                <p><strong>Ejemplo:</strong> (x=2, y=3) es soluci√≥n de { x+y=5 ; 2x-y=1 } porque 2+3=5 y 2(2)-3=1</p>
            </div>

            <div class="definition-card">
                <h3>üî∑ Sistema Compatible/Incompatible</h3>
                <p><strong>Definici√≥n:</strong> Compatible tiene soluci√≥n (determinado si es √∫nica, indeterminado si son infinitas). Incompatible no tiene soluci√≥n.</p>
                <p><strong>Ejemplo:</strong> { x+y=5 ; x+y=3 } es incompatible (0=2 es contradictorio)</p>
            </div>

            <div class="definition-card">
                <h3>üî∑ Determinante</h3>
                <p><strong>Definici√≥n:</strong> Valor num√©rico que se calcula a partir de una matriz cuadrada. Si |A|‚â†0, el sistema tiene soluci√≥n √∫nica.</p>
                <p><strong>Ejemplo:</strong> Para { 2x+y=5 ; x-3y=-8 }, |A| = 2(-3) - 1(1) = -7 ‚â† 0</p>
            </div>
        </div>

        <!-- Tab 2: S√≠mbolos -->
        <div class="content-section" id="simbolos">
            <h2>üî£ S√≠mbolos en Sistemas de Ecuaciones</h2>
            
            <div class="info-box bg-gradient-primary-white">
                <p>Conoce la notaci√≥n matem√°tica utilizada en sistemas de ecuaciones:</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">{ }</div>
                <div class="symbol-info">
                    <h3>Llave</h3>
                    <p><strong>Significado:</strong> Agrupa las ecuaciones que forman un sistema</p>
                    <p><strong>Uso:</strong> { x + y = 5 ; 2x - y = 1 }</p>
                </div>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">x, y, z</div>
                <div class="symbol-info">
                    <h3>Inc√≥gnitas</h3>
                    <p><strong>Significado:</strong> Variables desconocidas que debemos encontrar</p>
                    <p><strong>Uso:</strong> 3x + 2y = 12</p>
                </div>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">=</div>
                <div class="symbol-info">
                    <h3>Igual</h3>
                    <p><strong>Significado:</strong> Igualdad entre dos expresiones algebraicas</p>
                    <p><strong>Uso:</strong> 5x - 2y = 4</p>
                </div>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">SCD/SCI/SI</div>
                <div class="symbol-info">
                    <h3>Clasificaci√≥n</h3>
                    <p><strong>Significado:</strong> SCD (compatible determinado), SCI (compatible indeterminado), SI (incompatible)</p>
                    <p><strong>Uso:</strong> Clasifica sistemas seg√∫n su n√∫mero de soluciones</p>
                </div>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">|A|</div>
                <div class="symbol-info">
                    <h3>Determinante</h3>
                    <p><strong>Significado:</strong> Valor calculado de la matriz de coeficientes</p>
                    <p><strong>Uso:</strong> Si |A| ‚â† 0, el sistema tiene soluci√≥n √∫nica</p>
                </div>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">rango(A)</div>
                <div class="symbol-info">
                    <h3>Rango</h3>
                    <p><strong>Significado:</strong> N√∫mero de filas linealmente independientes de una matriz</p>
                    <p><strong>Uso:</strong> Teorema de Rouch√©-Frobenius para clasificar sistemas</p>
                </div>
            </div>
        </div>

        <!-- Tab 3: Introducci√≥n -->
        <div class="content-section" id="introduccion">
            <h2>üìö Introducci√≥n a Sistemas de Ecuaciones</h2>
            
            <div class="info-box bg-gradient-primary-white">
                <h3>¬øPor qu√© son importantes los sistemas de ecuaciones?</h3>
                <p>Los sistemas de ecuaciones lineales aparecen en innumerables situaciones del mundo real donde m√∫ltiples condiciones deben satisfacerse simult√°neamente. Son fundamentales en ciencia, ingenier√≠a, econom√≠a y tecnolog√≠a.</p>
            </div>

            <div class="application-card">
                <h3>üèóÔ∏è Ingenier√≠a</h3>
                <p><strong>Aplicaci√≥n:</strong> An√°lisis de estructuras, circuitos el√©ctricos, balanceo de fuerzas</p>
                <p><strong>Ejemplo:</strong> En un puente, las fuerzas en cada punto deben equilibrarse, generando sistemas de ecuaciones con las tensiones como inc√≥gnitas.</p>
            </div>

            <div class="application-card">
                <h3>üí∞ Econom√≠a y Negocios</h3>
                <p><strong>Aplicaci√≥n:</strong> Optimizaci√≥n de recursos, an√°lisis de mercados, modelos de oferta y demanda</p>
                <p><strong>Ejemplo:</strong> Determinar precios y cantidades de equilibrio cuando hay m√∫ltiples productos relacionados.</p>
            </div>

            <div class="application-card">
                <h3>‚öóÔ∏è F√≠sica y Qu√≠mica</h3>
                <p><strong>Aplicaci√≥n:</strong> Balanceo de ecuaciones qu√≠micas, leyes de conservaci√≥n, movimiento de part√≠culas</p>
                <p><strong>Ejemplo:</strong> Balancear C‚ÇÉH‚Çà + O‚ÇÇ ‚Üí CO‚ÇÇ + H‚ÇÇO requiere resolver un sistema para los coeficientes.</p>
            </div>

            <div class="application-card">
                <h3>üíª Programaci√≥n y Gr√°ficos</h3>
                <p><strong>Aplicaci√≥n:</strong> Gr√°ficos 3D, machine learning, procesamiento de im√°genes</p>
                <p><strong>Ejemplo:</strong> Calcular la intersecci√≥n de l√≠neas o planos en espacio 3D.</p>
            </div>

            <div class="application-card">
                <h3>üìä Estad√≠stica</h3>
                <p><strong>Aplicaci√≥n:</strong> Regresi√≥n lineal m√∫ltiple, ajuste de curvas</p>
                <p><strong>Ejemplo:</strong> Encontrar la mejor l√≠nea o curva que se ajusta a un conjunto de datos experimentales.</p>
            </div>
        </div>

        <!-- Tab 4: Teor√≠a -->
        <div class="content-section" id="teoria">
            <h2>üìñ Teor√≠a: Sistemas de Ecuaciones Lineales</h2>

            <h3>1. Clasificaci√≥n de Sistemas (2√ó2)</h3>
            <table class="comparison-table">
                <thead>
                    <tr><th>Tipo</th><th>Descripci√≥n</th><th>Soluciones</th><th>Condici√≥n</th></tr>
                </thead>
                <tbody>
                    <tr><td><strong>SCD</strong></td><td>Compatible Determinado</td><td>Una √∫nica</td><td>|A| ‚â† 0</td></tr>
                    <tr><td><strong>SCI</strong></td><td>Compatible Indeterminado</td><td>Infinitas</td><td>Ecuaciones proporcionales</td></tr>
                    <tr><td><strong>SI</strong></td><td>Incompatible</td><td>Ninguna</td><td>Contradicci√≥n (0=k, k‚â†0)</td></tr>
                </tbody>
            </table>

            <h3>2. M√©todo de Sustituci√≥n</h3>
            <div class="tool-card">
                <h4>üî¢ Calculadora: M√©todo de Sustituci√≥n</h4>
                <p>Resuelve { ax + by = c ; dx + ey = f }</p>
                <div class="tool-input-group">
                    <label>Primera ecuaci√≥n: ax + by = c</label>
                    <input type="number" id="sust-a" placeholder="a" style="width:60px"> x + 
                    <input type="number" id="sust-b" placeholder="b" style="width:60px"> y = 
                    <input type="number" id="sust-c" placeholder="c" style="width:60px">
                </div>
                <div class="tool-input-group">
                    <label>Segunda ecuaci√≥n: dx + ey = f</label>
                    <input type="number" id="sust-d" placeholder="d" style="width:60px"> x + 
                    <input type="number" id="sust-e" placeholder="e" style="width:60px"> y = 
                    <input type="number" id="sust-f" placeholder="f" style="width:60px">
                </div>
                <button class="calc-button" onclick="solveBySubstitution()">Resolver por Sustituci√≥n</button>
                <div class="calc-result" id="sust-result">Ingresa ambas ecuaciones para ver la soluci√≥n paso a paso</div>
            </div>

            <h3>3. M√©todo de Reducci√≥n (Eliminaci√≥n)</h3>
            <div class="info-box">
                <p>Se multiplican las ecuaciones para igualar coeficientes y luego se suman o restan para eliminar una inc√≥gnita.</p>
                <p><strong>Ventaja:</strong> Muy eficiente cuando los coeficientes son sencillos.</p>
            </div>

            <h3>4. Regla de Cramer</h3>
            <div class="tool-card">
                <h4>üìä Calculadora: Regla de Cramer</h4>
                <p>Usa determinantes para encontrar x e y</p>
                <div class="tool-input-group">
                    <label>Primera ecuaci√≥n (a,b,c):</label>
                    <input type="text" id="cramer-eq1" placeholder="Ej: 2,1,5">
                </div>
                <div class="tool-input-group">
                    <label>Segunda ecuaci√≥n (d,e,f):</label>
                    <input type="text" id="cramer-eq2" placeholder="Ej: 1,-3,-8">
                </div>
                <button class="calc-button" onclick="solveCramer()">Resolver con Cramer</button>
                <div class="calc-result" id="cramer-result">x = |Ax|/|A|, y = |Ay|/|A|</div>
            </div>

            <h3>5. M√©todo de Gauss</h3>
            <div class="info-box">
                <p>Transforma la matriz ampliada [A|b] en forma escalonada mediante operaciones elementales:</p>
                <ul>
                    <li>F<sub>i</sub> ‚Üî F<sub>j</sub> (intercambiar filas)</li>
                    <li>F<sub>i</sub> ‚Üí k¬∑F<sub>i</sub> (multiplicar fila por constante k‚â†0)</li>
                    <li>F<sub>i</sub> ‚Üí F<sub>i</sub> + k¬∑F<sub>j</sub> (sumar m√∫ltiplo de otra fila)</li>
                </ul>
            </div>

            <h3>6. Clasificador de Sistemas</h3>
            <div class="tool-card">
                <h4>üéØ Herramienta: Clasifica el Sistema</h4>
                <div class="tool-input-group">
                    <label>Primera ecuaci√≥n (a,b,c):</label>
                    <input type="text" id="class-eq1" placeholder="Ej: 1,1,5">
                </div>
                <div class="tool-input-group">
                    <label>Segunda ecuaci√≥n (d,e,f):</label>
                    <input type="text" id="class-eq2" placeholder="Ej: 1,1,3">
                </div>
                <button class="calc-button" onclick="classifySystem()">Clasificar Sistema</button>
                <div class="calc-result" id="class-result">¬øSCD, SCI o SI?</div>
            </div>
        </div>

        <!-- Tab 5: Entrenamiento -->
        <div class="content-section" id="entrenamiento">
            <h2>üéØ Entrenamiento</h2>
            
            <div class="info-box bg-gradient-primary-white">
                <p><strong>Instrucciones:</strong> Resuelve los sistemas de ecuaciones. Ingresa tus respuestas en el formato x,y (ejemplo: 2,3).</p>
                <p><strong>Puntos:</strong> +10 por respuesta correcta, -5 por incorrecta.</p>
            </div>

            <div class="exercise-card" id="exercise-container">
                <h3 id="exercise-title">Pregunta 1</h3>
                <p id="exercise-question">Cargando pregunta...</p>
                <div class="input-group">
                    <input type="text" id="exercise-answer" placeholder="x,y (Ej: 2,3)" onkeypress="if(event.key==='Enter') checkExercise()">
                    <button class="calc-button" onclick="checkExercise()">Verificar</button>
                </div>
                <div id="exercise-feedback"></div>
                <button class="btn btn-secondary mt-1rem" onclick="generateExercise()">Nueva Pregunta</button>
            </div>
        </div>

        <!-- Tab 6: Examen Final -->
        <div class="content-section" id="examen">
            <h2>üìù Examen Final de Sistemas de Ecuaciones</h2>
            
            <div class="info-box bg-gradient-primary-white">
                <p>Completa este examen para demostrar tu dominio de los sistemas de ecuaciones.</p>
                <p><strong>Requisitos:</strong> 70% o m√°s para aprobar (14/20 respuestas correctas)</p>
                <p><strong>Recompensa:</strong> Obt√©n el trofeo "Maestro de Sistemas" üèÜ</p>
            </div>

            <div id="exam-container">
                <button class="btn btn-primary btn-large" onclick="startExam()">Comenzar Examen Final</button>
            </div>

            <div id="exam-questions" style="display:none;">
                <!-- Questions will be dynamically generated -->
            </div>

            <div id="exam-results" style="display:none;">
                <h3>Resultados del Examen</h3>
                <div id="exam-score"></div>
                <div id="exam-feedback"></div>
                <button class="btn btn-secondary" onclick="reviewExam()">Revisar Respuestas</button>
                <button class="btn btn-primary" onclick="retakeExam()">Reintentar</button>
            </div>
        </div>
    </div>

    <script src="../../../../lib/storage.js"></script>
    <script src="../../../../lib/gamification.js"></script>
    <script src="../../../../lib/components.js"></script>
    
    <script>
        // Initialize page
        const MODULE_ID = 'sistemas-ecuaciones';
        const MODULE_TITLE = 'Sistemas de Ecuaciones';
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeModule();
            generateExercise();
        });

        function initializeModule() {
            createHeader(MODULE_TITLE);
            createTabs([
                { id: 'glosario', label: 'Glosario' },
                { id: 'simbolos', label: 'S√≠mbolos' },
                { id: 'introduccion', label: 'Introducci√≥n' },
                { id: 'teoria', label: 'Teor√≠a' },
                { id: 'entrenamiento', label: 'Entrenamiento' },
                { id: 'examen', label: 'Examen Final' }
            ]);
            updateScoreDisplay();
        }

        // Substitution method solver
        function solveBySubstitution() {
            const a = parseFloat(document.getElementById('sust-a').value);
            const b = parseFloat(document.getElementById('sust-b').value);
            const c = parseFloat(document.getElementById('sust-c').value);
            const d = parseFloat(document.getElementById('sust-d').value);
            const e = parseFloat(document.getElementById('sust-e').value);
            const f = parseFloat(document.getElementById('sust-f').value);

            if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d) || isNaN(e) || isNaN(f)) {
                document.getElementById('sust-result').innerHTML = '<span class="text-error">Por favor, completa todos los campos</span>';
                return;
            }

            const det = a*e - b*d;
            const resultDiv = document.getElementById('sust-result');

            if (det === 0) {
                resultDiv.innerHTML = '<span class="text-warning">El sistema no tiene soluci√≥n √∫nica (|A| = 0)</span>';
                return;
            }

            const x = (c*e - b*f) / det;
            const y = (a*f - c*d) / det;

            resultDiv.innerHTML = `
                <div class="success-result">
                    <strong>Soluci√≥n:</strong><br>
                    <strong>Paso 1:</strong> Despejamos y de la primera ecuaci√≥n: y = (${c} - ${a}x) / ${b}<br>
                    <strong>Paso 2:</strong> Sustituimos en la segunda ecuaci√≥n<br>
                    <strong>Paso 3:</strong> Resolvemos para x: x = ${x.toFixed(2)}<br>
                    <strong>Paso 4:</strong> Sustituimos x para hallar y: y = ${y.toFixed(2)}<br>
                    <strong>‚úÖ Respuesta: x = ${x.toFixed(2)}, y = ${y.toFixed(2)}</strong>
                </div>
            `;
        }

        // Cramer's rule solver
        function solveCramer() {
            const eq1 = document.getElementById('cramer-eq1').value.split(',').map(x => parseFloat(x.trim()));
            const eq2 = document.getElementById('cramer-eq2').value.split(',').map(x => parseFloat(x.trim()));

            if (eq1.length !== 3 || eq2.length !== 3 || eq1.some(isNaN) || eq2.some(isNaN)) {
                document.getElementById('cramer-result').innerHTML = '<span class="text-error">Formato incorrecto. Use: a,b,c</span>';
                return;
            }

            const [a, b, c] = eq1;
            const [d, e, f] = eq2;

            const detA = a*e - b*d;
            const detAx = c*e - b*f;
            const detAy = a*f - c*d;

            const resultDiv = document.getElementById('cramer-result');

            if (detA === 0) {
                resultDiv.innerHTML = '<span class="text-warning">|A| = 0, el sistema no tiene soluci√≥n √∫nica</span>';
                return;
            }

            const x = detAx / detA;
            const y = detAy / detA;

            resultDiv.innerHTML = `
                <div class="success-result">
                    <strong>Determinantes:</strong><br>
                    |A| = ${a}(${e}) - ${b}(${d}) = ${detA}<br>
                    |Ax| = ${c}(${e}) - ${b}(${f}) = ${detAx}<br>
                    |Ay| = ${a}(${f}) - ${c}(${d}) = ${detAy}<br>
                    <br>
                    <strong>Soluci√≥n:</strong><br>
                    x = ${detAx} / ${detA} = ${x.toFixed(2)}<br>
                    y = ${detAy} / ${detA} = ${y.toFixed(2)}<br>
                    <strong>‚úÖ (x, y) = (${x.toFixed(2)}, ${y.toFixed(2)})</strong>
                </div>
            `;
        }

        // System classifier
        function classifySystem() {
            const eq1 = document.getElementById('class-eq1').value.split(',').map(x => parseFloat(x.trim()));
            const eq2 = document.getElementById('class-eq2').value.split(',').map(x => parseFloat(x.trim()));

            if (eq1.length !== 3 || eq2.length !== 3 || eq1.some(isNaN) || eq2.some(isNaN)) {
                document.getElementById('class-result').innerHTML = '<span class="text-error">Formato incorrecto. Use: a,b,c</span>';
                return;
            }

            const [a, b, c] = eq1;
            const [d, e, f] = eq2;

            const det = a*e - b*d;
            const ratio1 = (b !== 0 && e !== 0) ? a/d : null;
            const ratio2 = (b !== 0 && e !== 0) ? b/e : null;
            const ratio3 = (c !== 0 && f !== 0) ? c/f : null;

            const resultDiv = document.getElementById('class-result');

            if (det !== 0) {
                resultDiv.innerHTML = `
                    <div class="success-result">
                        <strong>Clasificaci√≥n: SCD (Compatible Determinado)</strong><br>
                        |A| = ${det} ‚â† 0<br>
                        ‚úÖ El sistema tiene una soluci√≥n √∫nica
                    </div>
                `;
            } else if (ratio1 === ratio2 && ratio2 === ratio3) {
                resultDiv.innerHTML = `
                    <div class="info-result">
                        <strong>Clasificaci√≥n: SCI (Compatible Indeterminado)</strong><br>
                        Las ecuaciones son proporcionales<br>
                        ‚úÖ El sistema tiene infinitas soluciones
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="warning-result">
                        <strong>Clasificaci√≥n: SI (Sistema Incompatible)</strong><br>
                        Las ecuaciones son contradictorias<br>
                        ‚ùå El sistema no tiene soluci√≥n
                    </div>
                `;
            }
        }

        // Training exercises
        let currentExercise = null;

        function generateExercise() {
            const types = ['simple', 'medium', 'hard'];
            const type = types[Math.floor(Math.random() * types.length)];

            let a, b, c, d, e, f, x, y;

            if (type === 'simple') {
                x = Math.floor(Math.random() * 10) + 1;
                y = Math.floor(Math.random() * 10) + 1;
                a = 1;
                b = Math.floor(Math.random() * 3) + 1;
                d = Math.floor(Math.random() * 3) + 1;
                e = -b + Math.floor(Math.random() * 3) + 1;
                c = a*x + b*y;
                f = d*x + e*y;
            } else if (type === 'medium') {
                x = Math.floor(Math.random() * 8) + 1;
                y = Math.floor(Math.random() * 8) + 1;
                a = Math.floor(Math.random() * 5) + 1;
                b = Math.floor(Math.random() * 5) + 1;
                d = Math.floor(Math.random() * 5) + 1;
                e = Math.floor(Math.random() * 5) + 1;
                c = a*x + b*y;
                f = d*x + e*y;
            } else {
                x = Math.floor(Math.random() * 6) - 3;
                y = Math.floor(Math.random() * 6) - 3;
                a = Math.floor(Math.random() * 8) - 4;
                b = Math.floor(Math.random() * 8) - 4;
                d = Math.floor(Math.random() * 8) - 4;
                e = Math.floor(Math.random() * 8) - 4;
                if (a === 0) a = 1;
                if (d === 0) d = 2;
                c = a*x + b*y;
                f = d*x + e*y;
            }

            currentExercise = { x, y, a, b, c, d, e, f };

            document.getElementById('exercise-question').innerHTML = `
                Resuelve el sistema:<br>
                <div class="formula-box">
                    ${a}x ${b >= 0 ? '+' : ''} ${b}y = ${c}<br>
                    ${d}x ${e >= 0 ? '+' : ''} ${e}y = ${f}
                </div>
            `;
            document.getElementById('exercise-answer').value = '';
            document.getElementById('exercise-feedback').innerHTML = '';
        }

        function checkExercise() {
            const answer = document.getElementById('exercise-answer').value.trim();
            const parts = answer.split(',').map(x => parseFloat(x.trim()));

            if (parts.length !== 2 || parts.some(isNaN)) {
                document.getElementById('exercise-feedback').innerHTML = '<span class="text-error">Formato incorrecto. Use: x,y</span>';
                return;
            }

            const [userX, userY] = parts;
            const { x, y } = currentExercise;

            const isCorrect = Math.abs(userX - x) < 0.01 && Math.abs(userY - y) < 0.01;

            if (isCorrect) {
                addPoints(10);
                document.getElementById('exercise-feedback').innerHTML = `
                    <div class="success-result">
                        ‚úÖ ¬°Correcto! x = ${x}, y = ${y}<br>
                        +10 puntos
                    </div>
                `;
                setTimeout(generateExercise, 2000);
            } else {
                addPoints(-5);
                document.getElementById('exercise-feedback').innerHTML = `
                    <div class="error-result">
                        ‚ùå Incorrecto. La respuesta correcta es x = ${x}, y = ${y}<br>
                        -5 puntos
                    </div>
                `;
            }
        }

        // Final Exam
        let examQuestions = [];
        let examAnswers = [];
        let examStartTime = 0;

        function startExam() {
            examQuestions = generateExamQuestions();
            examAnswers = new Array(examQuestions.length).fill('');
            examStartTime = Date.now();

            document.getElementById('exam-container').style.display = 'none';
            document.getElementById('exam-questions').style.display = 'block';

            renderExamQuestions();
        }

        function generateExamQuestions() {
            const questions = [];

            for (let i = 0; i < 20; i++) {
                const x = Math.floor(Math.random() * 8) + 1;
                const y = Math.floor(Math.random() * 8) + 1;
                const a = Math.floor(Math.random() * 5) + 1;
                const b = Math.floor(Math.random() * 5) + 1;
                const d = Math.floor(Math.random() * 5) + 1;
                const e = Math.floor(Math.random() * 5) + 1;
                const c = a*x + b*y;
                const f = d*x + e*y;

                questions.push({
                    question: `${a}x ${b >= 0 ? '+' : ''} ${b}y = ${c} ; ${d}x ${e >= 0 ? '+' : ''} ${e}y = ${f}`,
                    answer: `${x},${y}`,
                    x, y
                });
            }

            return questions;
        }

        function renderExamQuestions() {
            let html = '<h3>Responde las 20 preguntas:</h3>';

            examQuestions.forEach((q, index) => {
                html += `
                    <div class="exam-question">
                        <p><strong>Pregunta ${index + 1}:</strong> Resuelve { ${q.question} }</p>
                        <input type="text" id="exam-answer-${index}" placeholder="x,y" value="${examAnswers[index]}">
                    </div>
                `;
            });

            html += '<button class="btn btn-primary btn-large mt-2rem" onclick="submitExam()">Enviar Examen</button>';

            document.getElementById('exam-questions').innerHTML = html;
        }

        function submitExam() {
            let correctCount = 0;

            examQuestions.forEach((q, index) => {
                const userAnswer = document.getElementById(`exam-answer-${index}`).value.trim();
                examAnswers[index] = userAnswer;

                const parts = userAnswer.split(',').map(x => parseFloat(x.trim()));
                if (parts.length === 2 && !parts.some(isNaN)) {
                    const [userX, userY] = parts;
                    if (Math.abs(userX - q.x) < 0.01 && Math.abs(userY - q.y) < 0.01) {
                        correctCount++;
                    }
                }
            });

            const percentage = (correctCount / examQuestions.length) * 100;
            const passed = percentage >= 70;

            // Save exam results
            saveExamResult(MODULE_ID, {
                score: percentage,
                passed: passed,
                attempts: getExamAttempts(MODULE_ID) + 1,
                correctAnswers: correctCount,
                totalQuestions: examQuestions.length
            });

            if (passed) {
                awardTrophy('sistemas-ecuaciones');
            }

            showExamResults(correctCount, examQuestions.length, passed);
        }

        function showExamResults(correct, total, passed) {
            document.getElementById('exam-questions').style.display = 'none';
            document.getElementById('exam-results').style.display = 'block';

            const percentage = ((correct / total) * 100).toFixed(1);

            document.getElementById('exam-score').innerHTML = `
                <div class="score-display ${passed ? 'success' : 'error'}">
                    <h3>Puntuaci√≥n: ${correct}/${total} (${percentage}%)</h3>
                </div>
            `;

            if (passed) {
                document.getElementById('exam-feedback').innerHTML = `
                    <div class="success-result">
                        <h3>üéâ ¬°Examen Aprobado!</h3>
                        <p>Has demostrado dominio de los sistemas de ecuaciones.</p>
                        <p>üèÜ Trofeo "Maestro de Sistemas" desbloqueado</p>
                    </div>
                `;
                showTrophyToast('Maestro de Sistemas', '¬°Has completado el m√≥dulo de Sistemas de Ecuaciones!');
            } else {
                document.getElementById('exam-feedback').innerHTML = `
                    <div class="error-result">
                        <h3>Necesitas 70% para aprobar</h3>
                        <p>Sigue practicando y vuelve a intentarlo.</p>
                    </div>
                `;
            }
        }

        function reviewExam() {
            let html = '<h3>Revisi√≥n del Examen:</h3>';

            examQuestions.forEach((q, index) => {
                const userAnswer = examAnswers[index];
                const parts = userAnswer.split(',').map(x => parseFloat(x.trim()));
                let isCorrect = false;

                if (parts.length === 2 && !parts.some(isNaN)) {
                    const [userX, userY] = parts;
                    isCorrect = Math.abs(userX - q.x) < 0.01 && Math.abs(userY - q.y) < 0.01;
                }

                html += `
                    <div class="exam-review-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <p><strong>Pregunta ${index + 1}:</strong> { ${q.question} }</p>
                        <p><strong>Tu respuesta:</strong> ${userAnswer || '(no respondida)'}</p>
                        <p><strong>Respuesta correcta:</strong> ${q.answer}</p>
                        <p>${isCorrect ? '‚úÖ Correcto' : '‚ùå Incorrecto'}</p>
                    </div>
                `;
            });

            document.getElementById('exam-results').innerHTML = html;
        }

        function retakeExam() {
            document.getElementById('exam-results').style.display = 'none';
            document.getElementById('exam-container').style.display = 'block';
        }
    </script>
</body>
</html>
