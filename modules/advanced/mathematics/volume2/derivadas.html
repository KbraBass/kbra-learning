<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derivadas - MatemÃ¡ticas Avanzadas Volume 2</title>
    <link rel="stylesheet" href="../../../../css/core.css">
    <link rel="stylesheet" href="../../../../css/components.css">
</head>
<body>
    <div id="header-container"></div>
    <div id="tabs-container"></div>
    <div id="score-container"></div>

    <div class="container">
        <!-- Glosario Tab -->
        <div class="content-section active" id="glosario">
            <h2>ğŸ“– Glosario de Derivadas</h2>
            
            <div class="info-box bg-gradient-primary-white">
                <p>Aprende los tÃ©rminos clave relacionados con las derivadas:</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”¹ Derivada</h3>
                <p><strong>DefiniciÃ³n:</strong> La tasa de cambio instantÃ¡nea de una funciÃ³n en un punto. GeomÃ©tricamente, es la pendiente de la recta tangente a la curva en ese punto.</p>
                <div class="formula-box">f'(x) = lim<sub>hâ†’0</sub> [f(x+h) - f(x)] / h</div>
                <p><strong>Ejemplo:</strong> Si f(x) = xÂ², entonces f'(x) = 2x. En x=3, la derivada es f'(3) = 6.</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”¹ Regla de la Cadena</h3>
                <p><strong>DefiniciÃ³n:</strong> Regla para derivar funciones compuestas. Si y = f(g(x)), entonces dy/dx = f'(g(x)) Â· g'(x).</p>
                <div class="formula-box">[f(g(x))]' = f'(g(x)) Â· g'(x)</div>
                <p><strong>Ejemplo:</strong> Para f(x) = (xÂ²+1)Â³, aplicamos la regla: f'(x) = 3(xÂ²+1)Â² Â· 2x = 6x(xÂ²+1)Â².</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”¹ Recta Tangente</h3>
                <p><strong>DefiniciÃ³n:</strong> Recta que toca a una curva en un punto y tiene la misma pendiente que la curva en ese punto. Su ecuaciÃ³n se obtiene usando la derivada.</p>
                <div class="formula-box">y - f(a) = f'(a)(x - a)</div>
                <p><strong>Ejemplo:</strong> Para f(x) = xÂ² en x=2: f(2)=4, f'(2)=4, tangente: y-4 = 4(x-2) â†’ y = 4x-4.</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”¹ DerivaciÃ³n ImplÃ­cita</h3>
                <p><strong>DefiniciÃ³n:</strong> TÃ©cnica para derivar ecuaciones donde y no estÃ¡ despejada en funciÃ³n de x. Se deriva ambos lados respecto a x, recordando que dy/dx es la incÃ³gnita.</p>
                <p><strong>Ejemplo:</strong> Para xÂ² + yÂ² = 25, derivando: 2x + 2yÂ·(dy/dx) = 0, entonces dy/dx = -x/y.</p>
            </div>

            <div class="glossary-term">
                <h3>ğŸ”¹ Derivadas de Orden Superior</h3>
                <p><strong>DefiniciÃ³n:</strong> Derivadas de la derivada. La segunda derivada f''(x) mide la concavidad de la funciÃ³n y, en fÃ­sica, representa la aceleraciÃ³n si f(x) es la posiciÃ³n.</p>
                <p><strong>Ejemplo:</strong> Si f(x) = xâ´, entonces f'(x) = 4xÂ³, f''(x) = 12xÂ², f'''(x) = 24x.</p>
            </div>
        </div>

        <!-- SÃ­mbolos Tab -->
        <div class="content-section" id="simbolos">
            <h2>ğŸ”£ SÃ­mbolos MatemÃ¡ticos</h2>
            
            <div class="info-box bg-gradient-primary-white">
                <p>NotaciÃ³n matemÃ¡tica utilizada en derivadas:</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-header">
                    <span class="symbol-icon">f'(x), df/dx, dy/dx</span>
                    <span class="symbol-name">Derivada</span>
                </div>
                <p><strong>Significado:</strong> Derivada de la funciÃ³n f respecto a x. Todas estas notaciones son equivalentes.</p>
                <p><strong>Uso:</strong> f'(x) = 2x significa que la derivada de f en x es 2x</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-header">
                    <span class="symbol-icon">f''(x), dÂ²f/dxÂ²</span>
                    <span class="symbol-name">Segunda Derivada</span>
                </div>
                <p><strong>Significado:</strong> Derivada de la derivada. Mide la curvatura o concavidad de la funciÃ³n.</p>
                <p><strong>Uso:</strong> f''(x) > 0 indica que la funciÃ³n es convexa (âˆª), f''(x) < 0 indica cÃ³ncava (âˆ©)</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-header">
                    <span class="symbol-icon">lim<sub>hâ†’0</sub></span>
                    <span class="symbol-name">LÃ­mite cuando h tiende a 0</span>
                </div>
                <p><strong>Significado:</strong> Valor al que se aproxima una expresiÃ³n cuando h se acerca a 0.</p>
                <p><strong>Uso:</strong> En la definiciÃ³n de derivada: lim<sub>hâ†’0</sub> [f(x+h) - f(x)]/h</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-header">
                    <span class="symbol-icon">âˆ‚f/âˆ‚x</span>
                    <span class="symbol-name">Derivada Parcial</span>
                </div>
                <p><strong>Significado:</strong> Derivada respecto a una variable manteniendo las demÃ¡s constantes (funciones de varias variables).</p>
                <p><strong>Uso:</strong> Para f(x,y) = xÂ²y, âˆ‚f/âˆ‚x = 2xy</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-header">
                    <span class="symbol-icon">Î”x, Î”y</span>
                    <span class="symbol-name">Incrementos</span>
                </div>
                <p><strong>Significado:</strong> Cambio o diferencia en el valor de x o y.</p>
                <p><strong>Uso:</strong> Î”y/Î”x es la tasa de cambio promedio, mientras que dy/dx es la tasa instantÃ¡nea</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-header">
                    <span class="symbol-icon">n Â· x<sup>n-1</sup></span>
                    <span class="symbol-name">Regla de la Potencia</span>
                </div>
                <p><strong>Significado:</strong> FÃ³rmula para derivar funciones potencia.</p>
                <p><strong>Uso:</strong> (xÂ³)' = 3xÂ², (xâµ)' = 5xâ´</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-header">
                    <span class="symbol-icon">âˆ˜</span>
                    <span class="symbol-name">ComposiciÃ³n de Funciones</span>
                </div>
                <p><strong>Significado:</strong> OperaciÃ³n de componer funciones: (fâˆ˜g)(x) = f(g(x)).</p>
                <p><strong>Uso:</strong> Se deriva con la regla de la cadena</p>
            </div>
        </div>

        <!-- IntroducciÃ³n Tab -->
        <div class="content-section" id="introduccion">
            <h2>ğŸ“š IntroducciÃ³n a las Derivadas</h2>
            
            <div class="info-box bg-gradient-success-white">
                <h3>Â¿Por quÃ© son importantes las derivadas?</h3>
                <p>Las derivadas son una de las herramientas matemÃ¡ticas mÃ¡s poderosas y Ãºtiles. Nos permiten medir cÃ³mo cambian las cosas, optimizar procesos, y entender fenÃ³menos del mundo real.</p>
            </div>

            <div class="application-section">
                <h3>ğŸ—ï¸ IngenierÃ­a y FÃ­sica</h3>
                <div class="info-box">
                    <ul>
                        <li><strong>Velocidad y aceleraciÃ³n:</strong> Si s(t) es la posiciÃ³n de un objeto, v(t) = s'(t) es su velocidad y a(t) = s''(t) es su aceleraciÃ³n.</li>
                        <li><strong>OptimizaciÃ³n estructural:</strong> Minimizar el uso de materiales manteniendo la resistencia.</li>
                        <li><strong>Circuitos elÃ©ctricos:</strong> La corriente es la derivada de la carga respecto al tiempo.</li>
                        <li><strong>MecÃ¡nica de fluidos:</strong> Gradientes de presiÃ³n, velocidad de flujo.</li>
                    </ul>
                </div>
            </div>

            <div class="application-section">
                <h3>ğŸ’° EconomÃ­a y Finanzas</h3>
                <div class="info-box">
                    <ul>
                        <li><strong>Costo marginal:</strong> C'(x) indica el costo de producir una unidad adicional.</li>
                        <li><strong>Ingreso marginal:</strong> R'(x) muestra el ingreso adicional por vender una unidad mÃ¡s.</li>
                        <li><strong>OptimizaciÃ³n de beneficios:</strong> Encontrar el nivel de producciÃ³n que maximiza ganancias.</li>
                        <li><strong>Elasticidad de la demanda:</strong> Mide sensibilidad del consumidor a cambios de precio.</li>
                    </ul>
                </div>
            </div>

            <div class="application-section">
                <h3>ğŸ”¬ Ciencias Naturales y Medicina</h3>
                <div class="info-box">
                    <ul>
                        <li><strong>Crecimiento de poblaciones:</strong> dP/dt = kP (crecimiento exponencial).</li>
                        <li><strong>DifusiÃ³n de sustancias:</strong> Ley de Fick relaciona el flujo con el gradiente de concentraciÃ³n.</li>
                        <li><strong>Farmaco cinÃ©tica:</strong> Velocidad de absorciÃ³n y eliminaciÃ³n de medicamentos.</li>
                        <li><strong>Reacciones quÃ­micas:</strong> Velocidad de reacciÃ³n como derivada de la concentraciÃ³n.</li>
                    </ul>
                </div>
            </div>

            <div class="application-section">
                <h3>ğŸ’» ComputaciÃ³n y TecnologÃ­a</h3>
                <div class="info-box">
                    <ul>
                        <li><strong>Machine Learning:</strong> Descenso del gradiente para entrenar redes neuronales.</li>
                        <li><strong>GrÃ¡ficos por computadora:</strong> Calcular normales para iluminaciÃ³n realista.</li>
                        <li><strong>CompresiÃ³n de datos:</strong> Optimizar algoritmos de compresiÃ³n.</li>
                        <li><strong>Procesamiento de seÃ±ales:</strong> Detectar cambios abruptos en seÃ±ales.</li>
                    </ul>
                </div>
            </div>

            <div class="application-section">
                <h3>ğŸ¨ DiseÃ±o y Arquitectura</h3>
                <div class="info-box">
                    <ul>
                        <li><strong>Curvas suaves:</strong> Curvas de BÃ©zier para diseÃ±o grÃ¡fico y CAD.</li>
                        <li><strong>OptimizaciÃ³n de formas:</strong> Minimizar la resistencia al aire en diseÃ±o aerodinÃ¡mico.</li>
                        <li><strong>AnÃ¡lisis estructural:</strong> Calcular puntos de mÃ¡xima tensiÃ³n en edificios.</li>
                        <li><strong>IluminaciÃ³n:</strong> Calcular Ã¡ngulos de incidencia de luz.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- TeorÃ­a y PrÃ¡ctica Tab -->
        <div class="content-section" id="teoria">
            <h2>ğŸ“ TeorÃ­a y PrÃ¡ctica de Derivadas</h2>

            <h3>1. Concepto de Derivada</h3>
            <div class="info-box">
                <p><strong>DefiniciÃ³n:</strong> La derivada de una funciÃ³n f en un punto x es el lÃ­mite:</p>
                <div class="formula-box">f'(x) = lim<sub>hâ†’0</sub> [f(x+h) - f(x)] / h</div>
                <p><strong>InterpretaciÃ³n geomÃ©trica:</strong> Pendiente de la recta tangente a la curva en (x, f(x)).</p>
                <p><strong>InterpretaciÃ³n fÃ­sica:</strong> Tasa de cambio instantÃ¡nea (velocidad si f es posiciÃ³n).</p>
            </div>

            <h3>2. Reglas BÃ¡sicas de DerivaciÃ³n</h3>
            <table class="comparison-table">
                <thead>
                    <tr><th>FunciÃ³n</th><th>Derivada</th><th>Ejemplo</th></tr>
                </thead>
                <tbody>
                    <tr><td>c (constante)</td><td>0</td><td>(5)' = 0</td></tr>
                    <tr><td>x<sup>n</sup></td><td>nÂ·x<sup>n-1</sup></td><td>(xÂ³)' = 3xÂ²</td></tr>
                    <tr><td>e<sup>x</sup></td><td>e<sup>x</sup></td><td>(e<sup>x</sup>)' = e<sup>x</sup></td></tr>
                    <tr><td>a<sup>x</sup></td><td>a<sup>x</sup>Â·ln(a)</td><td>(2<sup>x</sup>)' = 2<sup>x</sup>Â·ln(2)</td></tr>
                    <tr><td>ln(x)</td><td>1/x</td><td>(ln(x))' = 1/x</td></tr>
                    <tr><td>log<sub>a</sub>(x)</td><td>1/(xÂ·ln(a))</td><td>(log<sub>2</sub>(x))' = 1/(xÂ·ln(2))</td></tr>
                    <tr><td>sin(x)</td><td>cos(x)</td><td>(sin(x))' = cos(x)</td></tr>
                    <tr><td>cos(x)</td><td>-sin(x)</td><td>(cos(x))' = -sin(x)</td></tr>
                    <tr><td>tan(x)</td><td>secÂ²(x) = 1/cosÂ²(x)</td><td>(tan(x))' = secÂ²(x)</td></tr>
                </tbody>
            </table>

            <h3>3. Reglas de Operaciones</h3>
            <div class="info-box">
                <ul>
                    <li><strong>Suma/Resta:</strong> (f Â± g)' = f' Â± g'</li>
                    <li><strong>Producto por constante:</strong> (cÂ·f)' = cÂ·f'</li>
                    <li><strong>Producto:</strong> (fÂ·g)' = f'Â·g + fÂ·g' (Regla del producto)</li>
                    <li><strong>Cociente:</strong> (f/g)' = (f'Â·g - fÂ·g') / gÂ² (Regla del cociente)</li>
                    <li><strong>Cadena:</strong> [f(g(x))]' = f'(g(x)) Â· g'(x) (Regla de la cadena)</li>
                </ul>
            </div>

            <h3>4. Herramientas Interactivas</h3>

            <div class="tool-card">
                <h4>ğŸ“ Derivada de Potencias</h4>
                <p>Calcula la derivada de f(x) = ax<sup>n</sup> usando la regla de la potencia</p>
                <div class="tool-input-group">
                    <label>Coeficiente a:</label>
                    <input type="number" step="any" id="der-a" placeholder="Ej: 3">
                </div>
                <div class="tool-input-group">
                    <label>Exponente n:</label>
                    <input type="number" step="any" id="der-n" placeholder="Ej: 4">
                </div>
                <button class="calc-button" onclick="calculateDerivative()">Derivar</button>
                <div class="calc-result" id="der-result">Ingresa los datos y haz clic en Derivar</div>
            </div>

            <div class="tool-card">
                <h4>ğŸ“ Recta Tangente</h4>
                <p>Encuentra la ecuaciÃ³n de la recta tangente a f(x) = axÂ² + bx + c en el punto xâ‚€</p>
                <div class="tool-input-group">
                    <label>Coeficientes (a,b,c):</label>
                    <input type="text" id="tang-coef" placeholder="Ej: 1,0,0 para f(x)=xÂ²">
                </div>
                <div class="tool-input-group">
                    <label>Punto xâ‚€:</label>
                    <input type="number" step="any" id="tang-x0" placeholder="Ej: 2">
                </div>
                <button class="calc-button" onclick="calculateTangent()">Calcular Tangente</button>
                <div class="calc-result" id="tang-result">Ingresa los datos y haz clic en Calcular</div>
            </div>

            <div class="tool-card">
                <h4>ğŸ”¢ Evaluar Derivada en un Punto</h4>
                <p>EvalÃºa f'(xâ‚€) para f(x) = xÂ² (puedes modificar para otras funciones)</p>
                <div class="tool-input-group">
                    <label>Punto xâ‚€:</label>
                    <input type="number" step="any" id="eval-x0" placeholder="Ej: 3">
                </div>
                <button class="calc-button" onclick="evaluateDerivative()">Evaluar f'(xâ‚€)</button>
                <div class="calc-result" id="eval-result">Ingresa el punto y haz clic en Evaluar</div>
            </div>

            <h3>5. Ejemplos Resueltos</h3>
            
            <div class="info-box border-left-success">
                <h4 class="text-success">Ejemplo 1: Regla de la Potencia</h4>
                <p><strong>Problema:</strong> Deriva f(x) = xâ´</p>
                <p><strong>SoluciÃ³n:</strong> Aplicamos (x<sup>n</sup>)' = nÂ·x<sup>n-1</sup> con n=4</p>
                <p class="formula-box">f'(x) = 4Â·x<sup>4-1</sup> = 4xÂ³</p>
                <p><strong>Respuesta:</strong> f'(x) = 4xÂ³</p>
            </div>

            <div class="info-box border-left-success">
                <h4 class="text-success">Ejemplo 2: Regla del Producto</h4>
                <p><strong>Problema:</strong> Deriva f(x) = xÂ² Â· sin(x)</p>
                <p><strong>SoluciÃ³n:</strong> Usamos (fÂ·g)' = f'Â·g + fÂ·g' con f=xÂ² y g=sin(x)</p>
                <p>f' = 2x, g' = cos(x)</p>
                <p class="formula-box">f'(x) = 2xÂ·sin(x) + xÂ²Â·cos(x)</p>
                <p><strong>Respuesta:</strong> f'(x) = 2xÂ·sin(x) + xÂ²Â·cos(x)</p>
            </div>

            <div class="info-box border-left-success">
                <h4 class="text-success">Ejemplo 3: Regla del Cociente</h4>
                <p><strong>Problema:</strong> Deriva f(x) = x/(x+1)</p>
                <p><strong>SoluciÃ³n:</strong> Usamos (f/g)' = (f'Â·g - fÂ·g')/gÂ²</p>
                <p>f = x â†’ f' = 1, g = x+1 â†’ g' = 1</p>
                <p class="formula-box">f'(x) = [1Â·(x+1) - xÂ·1]/(x+1)Â² = 1/(x+1)Â²</p>
                <p><strong>Respuesta:</strong> f'(x) = 1/(x+1)Â²</p>
            </div>

            <div class="info-box border-left-success">
                <h4 class="text-success">Ejemplo 4: Regla de la Cadena</h4>
                <p><strong>Problema:</strong> Deriva f(x) = (2x+3)âµ</p>
                <p><strong>SoluciÃ³n:</strong> Sea u = 2x+3, entonces f = uâµ</p>
                <p>df/du = 5uâ´, du/dx = 2</p>
                <p class="formula-box">f'(x) = 5(2x+3)â´ Â· 2 = 10(2x+3)â´</p>
                <p><strong>Respuesta:</strong> f'(x) = 10(2x+3)â´</p>
            </div>

            <div class="info-box border-left-success">
                <h4 class="text-success">Ejemplo 5: Recta Tangente</h4>
                <p><strong>Problema:</strong> Encuentra la recta tangente a f(x) = xÂ² en x = 1</p>
                <p><strong>SoluciÃ³n:</strong></p>
                <p>1. f(1) = 1Â² = 1 (punto de tangencia: (1,1))</p>
                <p>2. f'(x) = 2x, entonces f'(1) = 2 (pendiente)</p>
                <p>3. EcuaciÃ³n: y - 1 = 2(x - 1)</p>
                <p class="formula-box">y = 2x - 1</p>
                <p><strong>Respuesta:</strong> y = 2x - 1</p>
            </div>
        </div>

        <!-- Entrenamiento Tab -->
        <div class="content-section" id="entrenamiento">
            <h2>ğŸ¯ Entrenamiento - Derivadas</h2>
            
            <div class="info-box bg-gradient-warning-white">
                <h3>ğŸ’ª Practica tus habilidades</h3>
                <p><strong>Instrucciones:</strong> Resuelve cada ejercicio y verifica tu respuesta. Recuerda:</p>
                <ul>
                    <li>âœ… Respuesta correcta: +10 puntos</li>
                    <li>âŒ Respuesta incorrecta: -5 puntos</li>
                    <li>ğŸ’¡ Puedes usar las pistas si necesitas ayuda</li>
                    <li>ğŸ”„ Puedes practicar tantas veces como quieras</li>
                </ul>
            </div>

            <div id="exercises-container"></div>
        </div>

        <!-- Examen Final Tab -->
        <div class="content-section" id="examen">
            <h2>ğŸ“ Examen Final de Derivadas</h2>
            
            <div class="info-box bg-gradient-danger-white">
                <h3>ğŸ“ Demuestra tu dominio</h3>
                <p><strong>Requisitos:</strong> 70% o mÃ¡s para aprobar (14/20 respuestas correctas)</p>
                <p><strong>Recompensa:</strong> ObtÃ©n el trofeo "Maestro de Derivadas" ğŸ†</p>
                <p><strong>Importante:</strong> Este examen no afecta tu puntuaciÃ³n, solo determina si apruebas el mÃ³dulo.</p>
            </div>

            <div id="exam-container"></div>
            
            <div class="exam-actions" id="exam-actions">
                <button class="btn btn-success btn-lg" onclick="startExam()">Comenzar Examen</button>
            </div>

            <div class="exam-results" id="exam-results" style="display: none;"></div>
        </div>
    </div>

    <script src="../../../../lib/storage.js"></script>
    <script src="../../../../lib/gamification.js"></script>
    <script src="../../../../lib/components.js"></script>
    <script>
        const MODULE_ID = 'derivadas';
        const MODULE_TITLE = 'Derivadas';

        document.addEventListener('DOMContentLoaded', function() {
            Components.createHeader(MODULE_TITLE, 'index.html');
            Components.createTabs([
                { id: 'glosario', label: 'Glosario', icon: 'ğŸ“–' },
                { id: 'simbolos', label: 'SÃ­mbolos', icon: 'ğŸ”£' },
                { id: 'introduccion', label: 'IntroducciÃ³n', icon: 'ğŸ“š' },
                { id: 'teoria', label: 'TeorÃ­a y PrÃ¡ctica', icon: 'ğŸ“' },
                { id: 'entrenamiento', label: 'Entrenamiento', icon: 'ğŸ¯' },
                { id: 'examen', label: 'Examen Final', icon: 'ğŸ“' }
            ], 'glosario');
            Components.createScoreDisplay();
            loadExercises();
            Gamification.updateDisplay(MODULE_ID);
        });

        // Ejercicios de entrenamiento (puntuaciÃ³n +10/-5)
        const exercises = [
            { id: 1, question: 'Â¿CuÃ¡l es la derivada de f(x) = xÂ³?', correct: '3xÂ²', options: ['3xÂ²', 'xÂ²', '3x', 'xÂ³'], hint: 'Usa la regla de la potencia: (xâ¿)' = nÂ·x<sup>n-1</sup>' },
            { id: 2, question: 'Â¿CuÃ¡l es la derivada de una constante f(x) = 5?', correct: '0', options: ['0', '5', '1', 'x'], hint: 'Las constantes siempre derivan a 0' },
            { id: 3, question: 'Â¿CuÃ¡l es el coeficiente de xâ´ en la derivada de f(x) = xâµ?', correct: '5', options: ['5', '4', '1', '20'], hint: '(xâµ)' = 5xâ´, el coeficiente es 5' },
            { id: 4, question: 'Â¿CuÃ¡l es la derivada de f(x) = e<sup>x</sup>?', correct: 'e<sup>x</sup>', options: ['e<sup>x</sup>', 'xe<sup>x-1</sup>', '0', 'ln(x)'], hint: 'La derivada de e<sup>x</sup> es ella misma' },
            { id: 5, question: 'Â¿CuÃ¡l es la derivada de f(x) = ln(x)?', correct: '1/x', options: ['1/x', 'x', '1', 'ln(x)'], hint: '(ln(x))' = 1/x' },
            { id: 6, question: 'Si f(x) = sin(x), Â¿cuÃ¡nto vale f\'(Ï€)?', correct: '-1', options: ['-1', '0', '1', 'Ï€'], hint: '(sin(x))' = cos(x), y cos(Ï€) = -1' },
            { id: 7, question: 'Para f(x) = xÂ², la pendiente de la tangente en x=2 es:', correct: '4', options: ['4', '2', '8', '0'], hint: 'f\'(x) = 2x, entonces f\'(2) = 4' },
            { id: 8, question: 'Si f(x) = xÂ², Â¿cuÃ¡nto vale f\'\'(x)?', correct: '2', options: ['2', '2x', '0', 'x'], hint: 'f\'(x) = 2x, entonces f\'\'(x) = 2' },
            { id: 9, question: 'Â¿CuÃ¡l es el coeficiente de xÂ² en la derivada de f(x) = 2xÂ³?', correct: '6', options: ['6', '3', '2', '8'], hint: '(2xÂ³)' = 6xÂ², el coeficiente es 6' },
            { id: 10, question: 'Si f(x) = xâ´, Â¿cuÃ¡nto vale f\'(1)?', correct: '4', options: ['4', '1', '3', '0'], hint: 'f\'(x) = 4xÂ³, entonces f\'(1) = 4' },
            { id: 11, question: 'Â¿CuÃ¡l es la derivada de f(x) = cos(x)?', correct: '-sin(x)', options: ['-sin(x)', 'sin(x)', '-cos(x)', '0'], hint: 'La derivada del coseno es menos seno' },
            { id: 12, question: 'Derivada de f(x) = 3xÂ² + 2x:', correct: '6x+2', options: ['6x+2', '3x+2', '6x', '5xÂ²'], hint: 'Deriva cada tÃ©rmino por separado' },
            { id: 13, question: 'Usando regla del producto, (xÂ·e<sup>x</sup>)' =', correct: 'e<sup>x</sup>+xÂ·e<sup>x</sup>', options: ['e<sup>x</sup>+xÂ·e<sup>x</sup>', 'xÂ·e<sup>x</sup>', 'e<sup>x</sup>', '2xÂ·e<sup>x</sup>'], hint: '(fÂ·g)' = f'Â·g + fÂ·g'. f=x, g=e<sup>x</sup>' },
            { id: 14, question: 'Â¿CuÃ¡l es la segunda derivada de f(x) = xÂ³?', correct: '6x', options: ['6x', '3xÂ²', 'xÂ²', '6'], hint: 'f\'(x) = 3xÂ², f\'\'(x) = 6x' },
            { id: 15, question: 'Regla de la cadena para f(x) = (xÂ²+1)Â², f\'(x) =', correct: '4x(xÂ²+1)', options: ['4x(xÂ²+1)', '2(xÂ²+1)', '2x', '4x'], hint: '[uÂ²]' = 2uÂ·u' con u = xÂ²+1' },
            { id: 16, question: 'Si f(x) = 1/x = xâ»Â¹, f\'(x) =', correct: '-1/xÂ²', options: ['-1/xÂ²', '1/x', '-xÂ²', '0'], hint: '(xâ»Â¹)' = -1Â·xâ»Â² = -1/xÂ²' },
            { id: 17, question: 'Derivada de f(x) = xÂ·sin(x):', correct: 'sin(x)+xÂ·cos(x)', options: ['sin(x)+xÂ·cos(x)', 'xÂ·cos(x)', 'sin(x)', 'cos(x)'], hint: 'Regla del producto: (x)\'sin(x) + x(sin(x))\'' },
            { id: 18, question: 'Â¿CuÃ¡l es la tercera derivada de f(x) = xâ´?', correct: '24x', options: ['24x', '12xÂ²', '4xÂ³', '24'], hint: 'f\'=4xÂ³, f\'\'=12xÂ², f\'\'\'=24x' },
            { id: 19, question: 'Para f(x) = e<sup>2x</sup>, f\'(x) =', correct: '2e<sup>2x</sup>', options: ['2e<sup>2x</sup>', 'e<sup>2x</sup>', '2xÂ·e<sup>2x-1</sup>', 'e<sup>x</sup>'], hint: 'Regla de la cadena: [e<sup>u</sup>]' = e<sup>u</sup>Â·u' con u=2x' },
            { id: 20, question: 'Derivada de f(x) = ln(2x):', correct: '1/x', options: ['1/x', '1/2x', '2/x', 'ln(2)'], hint: '[ln(u)]' = u'/u = 2/(2x) = 1/x' },
            { id: 21, question: 'Si f(x) = xâ¶, la derivada es:', correct: '6xâµ', options: ['6xâµ', 'xâµ', '6xâ¶', '5xâµ'], hint: 'Regla de la potencia con n=6' },
            { id: 22, question: 'Â¿CuÃ¡nto vale (2)' (derivada de la constante 2)?', correct: '0', options: ['0', '2', '1', 'x'], hint: 'Cualquier constante deriva a 0' },
            { id: 23, question: 'Derivada de f(x) = âˆšx = x<sup>1/2</sup>:', correct: '1/(2âˆšx)', options: ['1/(2âˆšx)', 'âˆšx', '1/x', 'x'], hint: '(x<sup>1/2</sup>)' = (1/2)x<sup>-1/2</sup> = 1/(2âˆšx)' },
            { id: 24, question: 'Si f(x)=tan(x), f\'(x) =', correct: 'secÂ²(x)', options: ['secÂ²(x)', 'cot(x)', 'cosÂ²(x)', '-tan(x)'], hint: 'La derivada de tangente es secante al cuadrado' },
            { id: 25, question: 'Regla del cociente: (x/xÂ²)' =', correct: '(1-x)/xÂ³', options: ['(1-x)/xÂ³', '1/x', '-1/xÂ²', '1/xÂ²'], hint: '[(f/g)]' = (f'g-fg')/gÂ². Simplifica (1Â·xÂ²-xÂ·2x)/xâ´' }
        ];

        function loadExercises() {
            const container = document.getElementById('exercises-container');
            container.innerHTML = exercises.map(ex => `
                <div class="exercise-card">
                    <h4>Ejercicio ${ex.id}</h4>
                    <p class="exercise-question">${ex.question}</p>
                    ${ex.options ? `
                        <div class="options-grid">
                            ${ex.options.map(opt => `
                                <button class="option-btn" onclick="checkExercise(${ex.id}, '${opt}')">${opt}</button>
                            `).join('')}
                        </div>
                    ` : `
                        <input type="text" id="ex${ex.id}" class="input-field" placeholder="Tu respuesta">
                        <button class="btn btn-primary" onclick="checkExercise(${ex.id})">Verificar</button>
                    `}
                    <button class="btn btn-secondary btn-sm" onclick="showHint(${ex.id})">ğŸ’¡ Pista</button>
                    <div id="hint${ex.id}" class="hint-box" style="display:none;">${ex.hint}</div>
                    <div id="feedback${ex.id}" class="feedback"></div>
                </div>
            `).join('');
        }

        function checkExercise(exerciseId, selectedAnswer) {
            const exercise = exercises.find(ex => ex.id === exerciseId);
            const feedback = document.getElementById('feedback' + exerciseId);
            let userAnswer;
            
            if (selectedAnswer !== undefined) {
                userAnswer = selectedAnswer;
            } else {
                const input = document.getElementById('ex' + exerciseId);
                userAnswer = input.value.trim();
            }
            
            const isCorrect = userAnswer.toLowerCase() === exercise.correct.toLowerCase();
            
            if (isCorrect) {
                feedback.className = 'feedback success';
                feedback.innerHTML = 'âœ… Â¡Correcto! +10 puntos';
                Gamification.completeExercise(MODULE_ID, true);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `âŒ Incorrecto. La respuesta correcta es: ${exercise.correct}. -5 puntos`;
                Gamification.completeExercise(MODULE_ID, false);
            }
            
            feedback.style.display = 'block';
            Gamification.updateDisplay(MODULE_ID);
        }

        function showHint(exerciseId) {
            const hint = document.getElementById('hint' + exerciseId);
            hint.style.display = hint.style.display === 'none' ? 'block' : 'none';
        }

        // Calculadoras
        function calculateDerivative() {
            const a = parseFloat(document.getElementById('der-a').value);
            const n = parseFloat(document.getElementById('der-n').value);
            const result = document.getElementById('der-result');
            
            if (isNaN(a) || isNaN(n)) {
                result.innerHTML = '<span class="text-error">âš ï¸ Por favor completa ambos campos</span>';
                return;
            }
            
            const newCoef = a * n;
            const newExp = n - 1;
            
            result.innerHTML = `
                <div class="success-box">
                    <strong>FunciÃ³n original:</strong> f(x) = ${a}x<sup>${n}</sup><br>
                    <strong>Regla aplicada:</strong> (ax<sup>n</sup>)' = aÂ·nÂ·x<sup>n-1</sup><br>
                    <strong>Derivada:</strong> f'(x) = ${newCoef}x<sup>${newExp}</sup>
                </div>
            `;
        }

        function calculateTangent() {
            const coefStr = document.getElementById('tang-coef').value;
            const x0 = parseFloat(document.getElementById('tang-x0').value);
            const result = document.getElementById('tang-result');
            
            if (!coefStr || isNaN(x0)) {
                result.innerHTML = '<span class="text-error">âš ï¸ Por favor completa todos los campos</span>';
                return;
            }
            
            const coeffs = coefStr.split(',').map(n => parseFloat(n.trim()));
            if (coeffs.length !== 3 || coeffs.some(isNaN)) {
                result.innerHTML = '<span class="text-error">âš ï¸ Formato incorrecto. Usa: a,b,c</span>';
                return;
            }
            
            const [a, b, c] = coeffs;
            const fx0 = a*x0*x0 + b*x0 + c;
            const fpx0 = 2*a*x0 + b;
            const b_tang = fx0 - fpx0*x0;
            
            result.innerHTML = `
                <div class="success-box">
                    <strong>FunciÃ³n:</strong> f(x) = ${a}xÂ² + ${b}x + ${c}<br>
                    <strong>Punto de tangencia:</strong> (${x0}, ${fx0.toFixed(2)})<br>
                    <strong>Derivada:</strong> f'(x) = ${2*a}x + ${b}<br>
                    <strong>Pendiente en xâ‚€:</strong> m = f'(${x0}) = ${fpx0.toFixed(2)}<br>
                    <strong>EcuaciÃ³n de la tangente:</strong> y = ${fpx0.toFixed(2)}x + ${b_tang.toFixed(2)}
                </div>
            `;
        }

        function evaluateDerivative() {
            const x0 = parseFloat(document.getElementById('eval-x0').value);
            const result = document.getElementById('eval-result');
            
            if (isNaN(x0)) {
                result.innerHTML = '<span class="text-error">âš ï¸ Por favor ingresa el punto</span>';
                return;
            }
            
            const derValue = 2 * x0;
            
            result.innerHTML = `
                <div class="success-box">
                    <strong>FunciÃ³n:</strong> f(x) = xÂ²<br>
                    <strong>Derivada:</strong> f'(x) = 2x<br>
                    <strong>EvaluaciÃ³n:</strong> f'(${x0}) = 2(${x0}) = <strong>${derValue}</strong><br>
                    <em>Esto significa que la pendiente de la tangente en x=${x0} es ${derValue}</em>
                </div>
            `;
        }

        // Examen Final (sin puntuaciÃ³n, solo aprobado/suspenso)
        const examQuestions = [
            { id: 1, question: 'Deriva f(x) = xâ·', correct: '7xâ¶', options: ['7xâ¶', 'xâ¶', '7xâ·', '6xâ¶'] },
            { id: 2, question: 'Deriva f(x) = 10', correct: '0', options: ['0', '10', '1', 'x'] },
            { id: 3, question: 'Deriva f(x) = 3xâ´ [coef de xÂ³]', correct: '12', options: ['12', '3', '4', '7'] },
            { id: 4, question: 'Deriva f(x) = sin(x)', correct: 'cos(x)', options: ['cos(x)', '-sin(x)', '-cos(x)', 'tan(x)'] },
            { id: 5, question: 'Deriva f(x) = e<sup>x</sup>', correct: 'e<sup>x</sup>', options: ['e<sup>x</sup>', 'xe<sup>x-1</sup>', '1', 'ln(x)'] },
            { id: 6, question: 'Si f(x)=xÂ³, f\'(2)=?', correct: '12', options: ['12', '6', '8', '3'] },
            { id: 7, question: 'Deriva f(x) = ln(x)', correct: '1/x', options: ['1/x', 'x', 'e<sup>x</sup>', 'ln(x)'] },
            { id: 8, question: 'Segunda derivada de f(x)=xâ´', correct: '12xÂ²', options: ['12xÂ²', '4xÂ³', '24x', '12'] },
            { id: 9, question: '(xÂ·sin(x))' [regla del producto]', correct: 'sin(x)+xÂ·cos(x)', options: ['sin(x)+xÂ·cos(x)', 'xÂ·cos(x)', 'cos(x)', 'sin(x)'] },
            { id: 10, question: 'Deriva f(x) = 5xÂ² + 3x', correct: '10x+3', options: ['10x+3', '5x+3', '10x', '15x'] },
            { id: 11, question: 'Pendiente tangente f(x)=xÂ² en x=3', correct: '6', options: ['6', '3', '9', '2'] },
            { id: 12, question: 'Deriva f(x) = cos(x)', correct: '-sin(x)', options: ['-sin(x)', 'sin(x)', '-cos(x)', '0'] },
            { id: 13, question: '(xÂ²+1)Â³ [regla cadena, coef x<sup>5</sup> tras derivar]', correct: '6', options: ['6', '3', '2', '12'] },
            { id: 14, question: 'Deriva f(x) = 1/x', correct: '-1/xÂ²', options: ['-1/xÂ²', '1/x', '1/xÂ²', '0'] },
            { id: 15, question: 'Si f(x)=2xÂ³, f\'(1)=?', correct: '6', options: ['6', '2', '3', '8'] },
            { id: 16, question: 'Deriva f(x) = âˆšx', correct: '1/(2âˆšx)', options: ['1/(2âˆšx)', 'âˆšx', '1/x', '2âˆšx'] },
            { id: 17, question: 'Tercera derivada de f(x)=xâµ', correct: '60xÂ²', options: ['60xÂ²', '20xÂ³', '5xâ´', '120x'] },
            { id: 18, question: '(e<sup>3x</sup>)\' [regla cadena]', correct: '3e<sup>3x</sup>', options: ['3e<sup>3x</sup>', 'e<sup>3x</sup>', '3xÂ·e<sup>3x-1</sup>', 'e<sup>x</sup>'] },
            { id: 19, question: 'Deriva f(x) = xâ´ + 2xÂ² - 5', correct: '4xÂ³+4x', options: ['4xÂ³+4x', '4xÂ³+2x', 'xÂ³+4x', '4xâ´+4xÂ²'] },
            { id: 20, question: 'Regla cociente: (1/xÂ²)\'', correct: '-2/xÂ³', options: ['-2/xÂ³', '2/xÂ³', '-1/x', '1/xÂ³'] },
            // 5 preguntas adicionales para selecciÃ³n aleatoria
            { id: 21, question: 'Si f(x)=sin(2x), f\'(x)=', correct: '2cos(2x)', options: ['2cos(2x)', 'cos(2x)', '2sin(2x)', 'cos(x)'] },
            { id: 22, question: '(ln(3x))\'', correct: '1/x', options: ['1/x', '1/3x', '3/x', 'ln(3)'] },
            { id: 23, question: 'Deriva f(x) = tan(x)', correct: 'secÂ²(x)', options: ['secÂ²(x)', 'cosÂ²(x)', 'cot(x)', 'sin(x)'] },
            { id: 24, question: 'Si f(x)=xÂ·e<sup>x</sup>, f\'(0)=', correct: '1', options: ['1', '0', 'e', '2'] },
            { id: 25, question: 'Segunda derivada de f(x)=e<sup>x</sup>', correct: 'e<sup>x</sup>', options: ['e<sup>x</sup>', '0', '1', 'xe<sup>x</sup>'] }
        ];

        let currentExam = [];
        let examStarted = false;

        function startExam() {
            // Seleccionar 20 preguntas aleatorias
            const shuffled = [...examQuestions].sort(() => Math.random() - 0.5);
            currentExam = shuffled.slice(0, 20);
            examStarted = true;

            const container = document.getElementById('exam-container');
            container.innerHTML = currentExam.map((q, index) => `
                <div class="exam-question">
                    <h4>Pregunta ${index + 1}</h4>
                    <p>${q.question}</p>
                    <div class="options-grid">
                        ${q.options.map(opt => `
                            <button class="option-btn" onclick="selectExamAnswer(${index}, '${opt}')" id="exam-q${index}-${opt}">
                                ${opt}
                            </button>
                        `).join('')}
                    </div>
                    <input type="hidden" id="exam-answer-${index}" value="">
                </div>
            `).join('');

            document.getElementById('exam-actions').innerHTML = `
                <button class="btn btn-success btn-lg" onclick="submitExam()">Enviar Examen</button>
                <button class="btn btn-secondary" onclick="cancelExam()">Cancelar</button>
            `;
        }

        function selectExamAnswer(questionIndex, answer) {
            document.getElementById('exam-answer-' + questionIndex).value = answer;
            
            // Visual feedback
            const question = currentExam[questionIndex];
            question.options.forEach(opt => {
                const btn = document.getElementById(`exam-q${questionIndex}-${opt}`);
                if (btn) {
                    btn.classList.remove('selected');
                    if (opt === answer) {
                        btn.classList.add('selected');
                    }
                }
            });
        }

        function submitExam() {
            let correctCount = 0;
            const totalQuestions = currentExam.length;

            currentExam.forEach((q, index) => {
                const userAnswer = document.getElementById('exam-answer-' + index).value;
                if (userAnswer === q.correct) {
                    correctCount++;
                }
            });

            const percentage = (correctCount / totalQuestions) * 100;
            const passed = percentage >= 70;

            const resultsDiv = document.getElementById('exam-results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div class="exam-result-card ${passed ? 'success' : 'error'}">
                    <h3>${passed ? 'ğŸ‰ Â¡Felicitaciones!' : 'ğŸ˜” No aprobaste'}</h3>
                    <p class="exam-score">PuntuaciÃ³n: ${correctCount}/${totalQuestions} (${percentage.toFixed(1)}%)</p>
                    <p>${passed ? 
                        'Â¡Has aprobado el examen! Has desbloqueado el trofeo "Maestro de Derivadas" ğŸ†' : 
                        'Necesitas al menos 70% para aprobar. Sigue practicando y vuelve a intentarlo.'
                    }</p>
                    ${passed ? '<div class="trophy-display">ğŸ† Maestro de Derivadas</div>' : ''}
                    <button class="btn btn-primary" onclick="resetExam()">
                        ${passed ? 'Volver al inicio' : 'Intentar de nuevo'}
                    </button>
                </div>
            `;

            if (passed) {
                Gamification.completeModule(MODULE_ID, percentage);
            }

            document.getElementById('exam-container').style.display = 'none';
            document.getElementById('exam-actions').style.display = 'none';
        }

        function cancelExam() {
            if (confirm('Â¿EstÃ¡s seguro de que quieres cancelar el examen?')) {
                resetExam();
            }
        }

        function resetExam() {
            examStarted = false;
            currentExam = [];
            document.getElementById('exam-container').innerHTML = '';
            document.getElementById('exam-results').style.display = 'none';
            document.getElementById('exam-results').innerHTML = '';
            document.getElementById('exam-actions').innerHTML = `
                <button class="btn btn-success btn-lg" onclick="startExam()">Comenzar Examen</button>
            `;
            document.getElementById('exam-container').style.display = 'block';
            document.getElementById('exam-actions').style.display = 'block';
        }
    </script>
</body>
</html>
