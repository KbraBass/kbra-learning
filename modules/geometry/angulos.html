<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬°Aprende √Ångulos! - Geometr√≠a Divertida</title>
    
    <!-- Shared CSS -->
    <link rel="stylesheet" href="../../css/core.css">
    <link rel="stylesheet" href="../../css/components.css">
    
    <style>
        /* Module-specific angle styles */
        .angle-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .angle-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .angle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .angle-visual {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .interactive-angle {
            width: 300px;
            height: 300px;
            margin: 30px auto;
            position: relative;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        #angle-canvas, #practice-canvas {
            width: 100%;
            height: 100%;
        }
        
        .angle-info {
            text-align: center;
            font-size: 1.5em;
            color: var(--primary-color);
            font-weight: bold;
            margin-top: 20px;
        }
        
        .protractor-tips {
            background: rgba(78, 205, 196, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .protractor-tips ol {
            text-align: left;
            max-width: 600px;
            margin: 0 auto;
            line-height: 2;
        }

        .glossary-term {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .symbol-card {
            background: white;
            padding: 25px;
            margin: 15px 0;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .symbol-display {
            font-size: 4em;
            color: var(--primary-color);
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="header-container"></div>
        <div id="tabs-container"></div>

        <!-- GLOSARIO TAB -->
        <div id="glosario" class="content tab-content active">
            <h2 class="section-title">üìñ Glosario de √Ångulos</h2>
            
            <div class="explanation">
                <p>Aprende los t√©rminos clave relacionados con los √°ngulos:</p>
            </div>

            <div class="glossary-term">
                <h3>üî∑ √Ångulo</h3>
                <p><strong>Definici√≥n:</strong> El espacio o abertura entre dos l√≠neas (llamadas lados) que se encuentran en un punto com√∫n (llamado v√©rtice). Se mide en grados (¬∞).</p>
                <p><strong>Ejemplo:</strong> La esquina de un libro forma un √°ngulo de 90¬∞</p>
            </div>

            <div class="glossary-term">
                <h3>üìç V√©rtice</h3>
                <p><strong>Definici√≥n:</strong> El punto donde se encuentran los dos lados de un √°ngulo. Es el "rinc√≥n" del √°ngulo.</p>
                <p><strong>Ejemplo:</strong> En la esquina de una mesa, el punto exacto donde se unen los bordes es el v√©rtice</p>
            </div>

            <div class="glossary-term">
                <h3>üìè Lado</h3>
                <p><strong>Definici√≥n:</strong> Cada una de las dos l√≠neas rectas que forman un √°ngulo. Los lados se extienden desde el v√©rtice.</p>
                <p><strong>Ejemplo:</strong> En una letra "V", cada una de las dos l√≠neas es un lado del √°ngulo</p>
            </div>

            <div class="glossary-term">
                <h3>üìê Grado (¬∞)</h3>
                <p><strong>Definici√≥n:</strong> La unidad que usamos para medir √°ngulos. Un c√≠rculo completo tiene 360 grados.</p>
                <p><strong>Ejemplo:</strong> Un √°ngulo recto mide exactamente 90¬∞, que es 1/4 de un c√≠rculo completo</p>
            </div>

            <div class="glossary-term">
                <h3>üìè Transportador</h3>
                <p><strong>Definici√≥n:</strong> Herramienta con forma de semic√≠rculo que se usa para medir √°ngulos. Est√° marcado de 0¬∞ a 180¬∞.</p>
                <p><strong>Ejemplo:</strong> Como un semic√≠rculo con n√∫meros que nos ayuda a saber cu√°ntos grados tiene un √°ngulo</p>
            </div>
        </div>

        <!-- S√çMBOLOS TAB -->
        <div id="simbolos" class="content tab-content">
            <h2 class="section-title">üî£ S√≠mbolos en √Ångulos</h2>
            
            <div class="explanation">
                <p>Conoce los s√≠mbolos matem√°ticos que se usan para representar √°ngulos:</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">‚à†</div>
                <h3>S√≠mbolo de √Ångulo</h3>
                <p><strong>Uso:</strong> Se escribe antes de las letras que nombran un √°ngulo</p>
                <p><strong>Ejemplo:</strong> ‚à†ABC significa "el √°ngulo ABC"</p>
                <p><strong>Se lee:</strong> "√Ångulo ABC"</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">¬∞</div>
                <h3>Grado</h3>
                <p><strong>Uso:</strong> Indica la medida del √°ngulo en grados</p>
                <p><strong>Ejemplo:</strong> 45¬∞ significa "cuarenta y cinco grados"</p>
                <p><strong>Se lee:</strong> "Grados"</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">‚ä•</div>
                <h3>Perpendicular</h3>
                <p><strong>Uso:</strong> Indica que dos l√≠neas forman un √°ngulo recto (90¬∞)</p>
                <p><strong>Ejemplo:</strong> AB ‚ä• CD significa que las l√≠neas AB y CD son perpendiculares</p>
                <p><strong>Se lee:</strong> "Es perpendicular a"</p>
            </div>

            <div class="symbol-card">
                <div class="symbol-display">‚ñ°</div>
                <h3>√Ångulo Recto</h3>
                <p><strong>Uso:</strong> Se dibuja un peque√±o cuadrado en el v√©rtice para indicar un √°ngulo de 90¬∞</p>
                <p><strong>Ejemplo:</strong> El s√≠mbolo ‚ñ° en una esquina significa que es un √°ngulo recto</p>
                <p><strong>Se lee:</strong> "√Ångulo recto"</p>
            </div>

            <div class="fun-facts">
                <h3>üí° Dato Curioso</h3>
                <p>El s√≠mbolo ‚à† viene de la palabra griega "Œ≥œâŒΩŒØŒ±" (gonia) que significa "esquina" o "√°ngulo".</p>
            </div>
        </div>

        <!-- INTRODUCCI√ìN TAB -->
        <div id="introduccion" class="content tab-content">
            <h2 class="section-title">üìö ¬øQu√© son los √Ångulos?</h2>
            
            <div class="explanation">
                <h3>¬øD√≥nde encontramos √°ngulos?</h3>
                <p>Los √°ngulos est√°n por todas partes en nuestra vida diaria. ¬°Vamos a descubrirlos!</p>
            </div>

            <div class="angle-card">
                <h3>üè† En la Arquitectura</h3>
                <p>Las casas y edificios est√°n llenos de √°ngulos: techos inclinados, escaleras, ventanas, puertas. Los arquitectos usan √°ngulos para hacer edificios fuertes y bonitos.</p>
                <p><strong>Ejemplo:</strong> El techo de una casa forma un √°ngulo agudo en la punta</p>
            </div>

            <div class="angle-card">
                <h3>üé® En el Arte</h3>
                <p>Los artistas usan √°ngulos para crear perspectiva y profundidad en sus dibujos. Las l√≠neas que se encuentran en diferentes √°ngulos hacen que las pinturas se vean m√°s realistas.</p>
                <p><strong>Ejemplo:</strong> Cuando dibujas un camino que se aleja, las l√≠neas forman √°ngulos</p>
            </div>

            <div class="angle-card">
                <h3>‚öΩ En los Deportes</h3>
                <p>El √°ngulo en que pateas un bal√≥n determina a d√≥nde va. Los jugadores profesionales calculan √°ngulos para hacer los mejores tiros.</p>
                <p><strong>Ejemplo:</strong> Un portero estudia el √°ngulo de tiro para saber d√≥nde bloquear</p>
            </div>

            <div class="angle-card">
                <h3>üïê En los Relojes</h3>
                <p>Las manecillas del reloj forman diferentes √°ngulos a lo largo del d√≠a. A las 3:00, forman un √°ngulo recto de 90¬∞.</p>
                <p><strong>Ejemplo:</strong> A las 3:00 en punto, el horario y minutero forman un √°ngulo de 90¬∞</p>
            </div>

            <div class="angle-card">
                <h3>‚úàÔ∏è En la Navegaci√≥n</h3>
                <p>Los pilotos y capitanes usan √°ngulos para navegar. El √°ngulo en que giras el volante o el tim√≥n determina tu nueva direcci√≥n.</p>
                <p><strong>Ejemplo:</strong> Un avi√≥n gira 45¬∞ a la derecha para cambiar de ruta</p>
            </div>

            <div class="fun-facts">
                <h3>üåü ¬°Dato Curioso!</h3>
                <p>Los antiguos babilonios dividieron el c√≠rculo en 360 grados hace m√°s de 4,000 a√±os. Eligieron 360 porque es un n√∫mero que se puede dividir f√°cilmente de muchas maneras: ¬Ω, ‚Öì, ¬º, ‚Öï, ‚Öô, ‚Öõ, ‚Öë, 1/10, 1/12, y muchas m√°s!</p>
            </div>
        </div>

        <!-- TEOR√çA TAB -->
        <div id="teoria" class="content tab-content">
            <h2 class="section-title">üìê Tipos de √Ångulos</h2>
            
            <div class="explanation">
                <h3>¬øQu√© es un √°ngulo?</h3>
                <p>Un √°ngulo es el espacio que hay entre dos l√≠neas que se encuentran. Los medimos en grados (¬∞).</p>
            </div>

            <div class="angle-types-grid">
                <div class="angle-card">
                    <h3>üìè √Ångulo Agudo</h3>
                    <div class="angle-visual">
                        <svg width="150" height="150">
                            <line x1="75" y1="120" x2="75" y2="30" stroke="var(--primary-color)" stroke-width="3"/>
                            <line x1="75" y1="120" x2="140" y2="80" stroke="var(--primary-color)" stroke-width="3"/>
                            <path d="M 75 100 Q 90 95 95 85" stroke="var(--accent-color)" fill="none" stroke-width="2"/>
                            <text x="95" y="95" fill="var(--primary-color)" font-size="16">45¬∞</text>
                        </svg>
                    </div>
                    <p><strong>Menor que 90¬∞</strong></p>
                    <p>Es un √°ngulo "peque√±o" o "cerrado"</p>
                </div>

                <div class="angle-card">
                    <h3>‚äø √Ångulo Recto</h3>
                    <div class="angle-visual">
                        <svg width="150" height="150">
                            <line x1="75" y1="120" x2="75" y2="30" stroke="var(--primary-color)" stroke-width="3"/>
                            <line x1="75" y1="120" x2="140" y2="120" stroke="var(--primary-color)" stroke-width="3"/>
                            <rect x="75" y="105" width="15" height="15" fill="none" stroke="var(--accent-color)" stroke-width="2"/>
                            <text x="95" y="100" fill="var(--primary-color)" font-size="16">90¬∞</text>
                        </svg>
                    </div>
                    <p><strong>Exactamente 90¬∞</strong></p>
                    <p>Como la esquina de un libro</p>
                </div>

                <div class="angle-card">
                    <h3>üìê √Ångulo Obtuso</h3>
                    <div class="angle-visual">
                        <svg width="150" height="150">
                            <line x1="75" y1="120" x2="75" y2="30" stroke="var(--primary-color)" stroke-width="3"/>
                            <line x1="75" y1="120" x2="30" y2="80" stroke="var(--primary-color)" stroke-width="3"/>
                            <path d="M 75 100 Q 60 90 50 85" stroke="var(--accent-color)" fill="none" stroke-width="2"/>
                            <text x="40" y="95" fill="var(--primary-color)" font-size="16">120¬∞</text>
                        </svg>
                    </div>
                    <p><strong>Mayor que 90¬∞ pero menor que 180¬∞</strong></p>
                    <p>Es un √°ngulo "abierto"</p>
                </div>

                <div class="angle-card">
                    <h3>‚Üî √Ångulo Llano</h3>
                    <div class="angle-visual">
                        <svg width="150" height="150">
                            <line x1="20" y1="75" x2="130" y2="75" stroke="var(--primary-color)" stroke-width="3"/>
                            <path d="M 40 75 Q 75 55 110 75" stroke="var(--accent-color)" fill="none" stroke-width="2"/>
                            <text x="65" y="50" fill="var(--primary-color)" font-size="16">180¬∞</text>
                        </svg>
                    </div>
                    <p><strong>Exactamente 180¬∞</strong></p>
                    <p>Forma una l√≠nea recta</p>
                </div>
            </div>

            <div class="explanation margin-top-30">
                <h3>üìè ¬øC√≥mo se Miden los √Ångulos?</h3>
                <p>Usamos una herramienta llamada <strong>transportador</strong> para medir √°ngulos. Tiene forma de semic√≠rculo y est√° marcado de 0¬∞ a 180¬∞.</p>
            </div>

            <div class="protractor-tips">
                <h3>üìê Pasos para Medir un √Ångulo:</h3>
                <ol>
                    <li><strong>Coloca el transportador:</strong> Pon el punto central del transportador exactamente en el v√©rtice del √°ngulo (donde se juntan las l√≠neas).</li>
                    <li><strong>Alinea la l√≠nea base:</strong> Haz que una de las l√≠neas del √°ngulo coincida con la l√≠nea de 0¬∞ del transportador.</li>
                    <li><strong>Lee el n√∫mero:</strong> Busca d√≥nde la otra l√≠nea cruza los n√∫meros del transportador.</li>
                    <li><strong>¬°Listo!</strong> Ese n√∫mero es la medida del √°ngulo en grados.</li>
                </ol>
            </div>

            <div class="explanation">
                <h3>üéÆ √Ångulo Interactivo</h3>
                <p>Mueve el control deslizante para cambiar el √°ngulo y ver c√≥mo se clasifica.</p>
            </div>

            <div class="interactive-angle">
                <canvas id="angle-canvas" width="300" height="300"></canvas>
            </div>

            <div class="input-section">
                <div class="input-group">
                    <label for="angle-slider">Ajusta el √°ngulo:</label>
                    <input type="range" id="angle-slider" min="0" max="180" value="45" 
                           class="width-full-max-400">
                </div>
            </div>

            <div class="angle-info" id="angle-info">
                <div id="angle-value">45¬∞</div>
                <div id="angle-type" style="font-size: 0.8em; color: var(--accent-color); margin-top: 10px;">√Ångulo Agudo</div>
            </div>

            <div class="fun-facts">
                <h3>üí° Trucos √ötiles:</h3>
                <ul>
                    <li>Si el √°ngulo parece grande (abierto), probablemente es obtuso (m√°s de 90¬∞)</li>
                    <li>Si parece peque√±o (cerrado), probablemente es agudo (menos de 90¬∞)</li>
                    <li>Si parece la esquina de un cuadrado, es recto (exactamente 90¬∞)</li>
                    <li>Una vuelta completa son 360¬∞ (como dar la vuelta completa en c√≠rculo)</li>
                </ul>
            </div>
        </div>

        <!-- ENTRENAMIENTO TAB -->
        <div id="entrenamiento" class="content tab-content">
            <h2 class="section-title">üèÜ ¬°Practica y Mejora!</h2>
            
            <div class="practice-area">
                <div id="score-container"></div>

                <h3 class="header-with-color" id="practice-question">Haz clic en "Nueva Pregunta" para empezar</h3>
                
                <div id="practice-visual" class="result-container-tall">
                    <canvas id="practice-canvas" width="200" height="200"></canvas>
                </div>

                <div class="input-section">
                    <div class="input-group">
                        <label for="practice-answer">Tu respuesta (tipo de √°ngulo):</label>
                        <select id="practice-answer">
                            <option value="">-- Selecciona --</option>
                            <option value="agudo">Agudo (menor que 90¬∞)</option>
                            <option value="recto">Recto (90¬∞)</option>
                            <option value="obtuso">Obtuso (mayor que 90¬∞)</option>
                            <option value="llano">Llano (180¬∞)</option>
                        </select>
                    </div>
                    <button class="calc-button" id="check-button" onclick="checkAnswer()">‚úÖ Comprobar</button>
                    <button class="calc-button" onclick="generateQuestion()">üîÑ Nueva Pregunta</button>
                    <div class="result" id="practice-result">¬°Genera una pregunta para empezar!</div>
                </div>
            </div>

            <div class="fun-facts">
                <h3>üí° Consejos:</h3>
                <ul>
                    <li>Si el √°ngulo parece peque√±o y cerrado, probablemente es agudo</li>
                    <li>Si parece la esquina de un cuadrado, es recto</li>
                    <li>Si est√° muy abierto pero no es una l√≠nea, es obtuso</li>
                    <li>Si forma una l√≠nea recta, es llano</li>
                </ul>
            </div>
        </div>

        <!-- EXAMEN FINAL TAB -->
        <div id="examen" class="content tab-content">
            <h2 class="section-title">üìù Examen Final de √Ångulos</h2>
            
            <div class="explanation">
                <p>Completa este examen para demostrar tu dominio de los √°ngulos.</p>
                <p><strong>Requisitos:</strong> 70% o m√°s para aprobar (14/20 respuestas correctas)</p>
                <p><strong>Recompensa:</strong> Obt√©n el trofeo "Experto en √Ångulos" üèÜ</p>
            </div>

            <div id="exam-container">
                <button class="calc-button" onclick="startExam()">‚ñ∂ Iniciar Examen</button>
                <div id="exam-status"></div>
            </div>

            <div id="exam-questions" style="display: none;">
                <!-- Questions will be inserted here -->
            </div>

            <div id="exam-results" style="display: none;">
                <h3 id="exam-score-title"></h3>
                <div id="exam-feedback"></div>
                <button class="calc-button" onclick="startExam()">üîÑ Reintentar Examen</button>
            </div>
        </div>
    </div>

    <script src="../../lib/storage.js"></script>
    <script src="../../lib/gamification.js"></script>
    <script src="../../lib/components.js"></script>

    <script>
        const MODULE_ID = 'angulos';
        let currentAngle = 45;
        let currentQuestion = null;
        let questionAnswered = false;
        let examQuestions = [];
        let examAnswers = [];

        function init() {
            const headerHtml = Components.createHeader(
                'üìê ¬°Aprende √Ångulos! üìê',
                'Descubre el mundo de los √°ngulos',
                '../index.html'
            );
            document.getElementById('header-container').innerHTML = headerHtml;

            const tabs = [
                { id: 'glosario', label: 'Glosario' },
                { id: 'simbolos', label: 'S√≠mbolos' },
                { id: 'introduccion', label: 'Introducci√≥n' },
                { id: 'teoria', label: 'Teor√≠a' },
                { id: 'entrenamiento', label: 'Entrenamiento' },
                { id: 'examen', label: 'Examen Final' }
            ];
            const tabsHtml = Components.createTabs(tabs, 'glosario');
            document.getElementById('tabs-container').innerHTML = tabsHtml;

            const scoreHtml = Components.createScoreDisplay();
            document.getElementById('score-container').innerHTML = scoreHtml;
            
            updateScoreDisplay();
            
            const slider = document.getElementById('angle-slider');
            if (slider) {
                slider.addEventListener('input', function() {
                    currentAngle = parseInt(this.value);
                    drawInteractiveAngle();
                    updateAngleInfo();
                });
            }
            
            Storage.updateStreak();
            updateExamStatus();
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            
            document.querySelectorAll('.tab-button').forEach(button => {
                const labels = { glosario: 'Glosario', simbolos: 'S√≠mbolos', introduccion: 'Introducci√≥n', 
                                teoria: 'Teor√≠a', entrenamiento: 'Entrenamiento', examen: 'Examen' };
                if (button.textContent.includes(labels[tabName])) {
                    button.classList.add('active');
                }
            });
            
            if (tabName === 'teoria') {
                setTimeout(() => {
                    drawInteractiveAngle();
                    updateAngleInfo();
                }, 100);
            } else if (tabName === 'examen') {
                updateExamStatus();
            }
        }

        function drawInteractiveAngle() {
            const canvas = document.getElementById('angle-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 300, 300);
            
            const centerX = 150;
            const centerY = 200;
            const radius = 100;
            
            // Base line
            ctx.beginPath();
            ctx.moveTo(centerX - radius, centerY);
            ctx.lineTo(centerX + radius, centerY);
            ctx.strokeStyle = '#4ECDC4';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Angle line
            const angleRad = (currentAngle * Math.PI) / 180;
            const endX = centerX + radius * Math.cos(Math.PI - angleRad);
            const endY = centerY - radius * Math.sin(Math.PI - angleRad);
            
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = '#4ECDC4';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Arc
            ctx.beginPath();
            ctx.arc(centerX, centerY, 40, Math.PI, Math.PI - angleRad, true);
            ctx.strokeStyle = '#FF6B6B';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Vertex dot
            ctx.beginPath();
            ctx.arc(centerX, centerY, 5, 0, 2 * Math.PI);
            ctx.fillStyle = '#4ECDC4';
            ctx.fill();
        }

        function updateAngleInfo() {
            const angleValue = document.getElementById('angle-value');
            const angleType = document.getElementById('angle-type');
            if (!angleValue || !angleType) return;

            angleValue.textContent = currentAngle + '¬∞';
            
            let type = '';
            if (currentAngle === 0) type = 'Sin √°ngulo';
            else if (currentAngle < 90) type = '√Ångulo Agudo';
            else if (currentAngle === 90) type = '√Ångulo Recto';
            else if (currentAngle < 180) type = '√Ångulo Obtuso';
            else if (currentAngle === 180) type = '√Ångulo Llano';
            
            angleType.textContent = type;
        }

        function generateQuestion() {
            const angles = [
                { value: 45, type: 'agudo' },
                { value: 30, type: 'agudo' },
                { value: 60, type: 'agudo' },
                { value: 75, type: 'agudo' },
                { value: 90, type: 'recto' },
                { value: 120, type: 'obtuso' },
                { value: 150, type: 'obtuso' },
                { value: 135, type: 'obtuso' },
                { value: 100, type: 'obtuso' },
                { value: 180, type: 'llano' }
            ];
            
            currentQuestion = angles[Math.floor(Math.random() * angles.length)];
            questionAnswered = false;
            
            document.getElementById('practice-question').textContent = `¬øQu√© tipo de √°ngulo es ${currentQuestion.value}¬∞?`;
            drawPracticeAngle(currentQuestion.value);
            
            document.getElementById('practice-answer').value = '';
            document.getElementById('practice-result').textContent = '¬°Selecciona tu respuesta!';
            document.getElementById('practice-result').style.background = 'rgba(255, 255, 255, 0.9)';
            
            const checkButton = document.getElementById('check-button');
            checkButton.disabled = false;
            checkButton.textContent = '‚úÖ Comprobar';
        }

        function drawPracticeAngle(angle) {
            const canvas = document.getElementById('practice-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 200, 200);
            
            const centerX = 100;
            const centerY = 150;
            const radius = 70;
            
            // Base line
            ctx.beginPath();
            ctx.moveTo(centerX - radius, centerY);
            ctx.lineTo(centerX + radius, centerY);
            ctx.strokeStyle = '#4ECDC4';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Angle line
            const angleRad = (angle * Math.PI) / 180;
            const endX = centerX + radius * Math.cos(Math.PI - angleRad);
            const endY = centerY - radius * Math.sin(Math.PI - angleRad);
            
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = '#4ECDC4';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Arc
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, Math.PI, Math.PI - angleRad, true);
            ctx.strokeStyle = '#FF6B6B';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Vertex dot
            ctx.beginPath();
            ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI);
            ctx.fillStyle = '#4ECDC4';
            ctx.fill();
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('practice-answer').value;
            const result = document.getElementById('practice-result');
            
            if (!currentQuestion || questionAnswered) return;
            
            if (!userAnswer) {
                result.textContent = '¬°Por favor, selecciona una respuesta!';
                result.style.background = 'rgba(255, 107, 107, 0.3)';
                return;
            }
            
            questionAnswered = true;
            const checkButton = document.getElementById('check-button');
            checkButton.disabled = true;
            checkButton.textContent = '‚úÖ Respondido';
            
            const typeNames = {
                'agudo': 'Agudo',
                'recto': 'Recto',
                'obtuso': 'Obtuso',
                'llano': 'Llano'
            };
            
            if (userAnswer === currentQuestion.type) {
                Gamification.addPoints(10, MODULE_ID);
                result.innerHTML = `<div class="text-dark">¬°Correcto! üéâ<br>${currentQuestion.value}¬∞ es un √°ngulo <strong>${typeNames[currentQuestion.type]}</strong><br><small>+10 puntos</small></div>`;
                result.style.background = 'rgba(78, 205, 196, 0.3)';
            } else {
                Gamification.subtractPoints(5, MODULE_ID);
                result.innerHTML = `<div class="text-dark">¬°Intenta de nuevo! üòä<br>${currentQuestion.value}¬∞ es un √°ngulo <strong>${typeNames[currentQuestion.type]}</strong><br><small>-5 puntos</small></div>`;
                result.style.background = 'rgba(255, 107, 107, 0.3)';
            }
            
            updateScoreDisplay();
        }

        function updateScoreDisplay() {
            document.getElementById('score').textContent = Storage.getTotalPoints();
            document.getElementById('level').textContent = Gamification.getCurrentLevel().name;
        }

        // EXAM FUNCTIONS
        function startExam() {
            examQuestions = generateExamQuestions();
            examAnswers = new Array(examQuestions.length).fill(null);
            
            document.getElementById('exam-container').style.display = 'none';
            document.getElementById('exam-results').style.display = 'none';
            document.getElementById('exam-questions').style.display = 'block';
            
            renderExamQuestions();
        }

        function generateExamQuestions() {
            const questionBank = [
                { q: "¬øCu√°ntos grados tiene un √°ngulo agudo?", a: "Menos de 90¬∞", options: ["Menos de 90¬∞", "Exactamente 90¬∞", "M√°s de 90¬∞", "Exactamente 180¬∞"] },
                { q: "¬øCu√°ntos grados tiene un √°ngulo recto?", a: "90¬∞", options: ["45¬∞", "90¬∞", "180¬∞", "360¬∞"] },
                { q: "¬øCu√°ntos grados tiene un √°ngulo obtuso?", a: "Entre 90¬∞ y 180¬∞", options: ["Menos de 90¬∞", "Exactamente 90¬∞", "Entre 90¬∞ y 180¬∞", "M√°s de 180¬∞"] },
                { q: "¬øCu√°ntos grados tiene un √°ngulo llano?", a: "180¬∞", options: ["90¬∞", "180¬∞", "270¬∞", "360¬∞"] },
                { q: "Un √°ngulo de 45¬∞ es:", a: "Agudo", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "Un √°ngulo de 135¬∞ es:", a: "Obtuso", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "¬øQu√© herramienta usamos para medir √°ngulos?", a: "Transportador", options: ["Regla", "Transportador", "Comp√°s", "Escuadra"] },
                { q: "¬øEn qu√© unidad se miden los √°ngulos?", a: "Grados", options: ["Metros", "Grados", "Cent√≠metros", "Litros"] },
                { q: "¬øC√≥mo se llama el punto donde se encuentran dos lados de un √°ngulo?", a: "V√©rtice", options: ["Centro", "V√©rtice", "Base", "C√∫spide"] },
                { q: "¬øCu√°ntos grados tiene una vuelta completa?", a: "360¬∞", options: ["180¬∞", "270¬∞", "360¬∞", "720¬∞"] },
                { q: "Un √°ngulo de 90¬∞ tambi√©n se llama:", a: "√Ångulo recto", options: ["√Ångulo agudo", "√Ångulo recto", "√Ångulo obtuso", "√Ångulo llano"] },
                { q: "Dos l√≠neas perpendiculares forman un √°ngulo de:", a: "90¬∞", options: ["45¬∞", "90¬∞", "180¬∞", "270¬∞"] },
                { q: "Un √°ngulo de 30¬∞ es:", a: "Agudo", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "Un √°ngulo de 120¬∞ es:", a: "Obtuso", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "Un √°ngulo de 60¬∞ es:", a: "Agudo", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "Un √°ngulo de 150¬∞ es:", a: "Obtuso", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "¬øCu√°l de estos NO es un tipo de √°ngulo?", a: "√Ångulo redondo", options: ["√Ångulo agudo", "√Ångulo recto", "√Ångulo redondo", "√Ångulo obtuso"] },
                { q: "Las esquinas de un libro forman √°ngulos de:", a: "90¬∞", options: ["45¬∞", "90¬∞", "180¬∞", "360¬∞"] },
                { q: "La mitad de un √°ngulo llano es:", a: "90¬∞", options: ["45¬∞", "90¬∞", "180¬∞", "270¬∞"] },
                { q: "Si un √°ngulo mide 85¬∞, es:", a: "Agudo", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "Si un √°ngulo mide 95¬∞, es:", a: "Obtuso", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "¬øCu√°ntos grados mide un cuarto de c√≠rculo?", a: "90¬∞", options: ["45¬∞", "90¬∞", "180¬∞", "360¬∞"] },
                { q: "¬øQu√© s√≠mbolo representa un √°ngulo?", a: "‚à†", options: ["¬∞", "‚à†", "‚ä•", "‚àû"] },
                { q: "Las manecillas del reloj a las 3:00 forman un √°ngulo:", a: "Recto", options: ["Agudo", "Recto", "Obtuso", "Llano"] },
                { q: "Un √°ngulo mayor que 90¬∞ pero menor que 180¬∞ es:", a: "Obtuso", options: ["Agudo", "Recto", "Obtuso", "Llano"] }
            ];

            // Shuffle and select 20 questions
            const shuffled = questionBank.sort(() => Math.random() - 0.5);
            return shuffled.slice(0, 20);
        }

        function renderExamQuestions() {
            const container = document.getElementById('exam-questions');
            let html = '<div class="exam-questions-container">';
            
            examQuestions.forEach((q, index) => {
                html += `
                    <div class="exam-question">
                        <h4>Pregunta ${index + 1}</h4>
                        <p>${q.q}</p>
                        <div class="exam-options">
                `;
                
                q.options.forEach((option, optIndex) => {
                    html += `
                        <label class="exam-option">
                            <input type="radio" name="q${index}" value="${option}" onchange="saveAnswer(${index}, '${option}')">
                            <span>${option}</span>
                        </label>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            html += '<button class="calc-button" onclick="submitExam()">üìù Enviar Examen</button>';
            
            container.innerHTML = html;
        }

        function saveAnswer(questionIndex, answer) {
            examAnswers[questionIndex] = answer;
        }

        function submitExam() {
            // Check if all questions answered
            if (examAnswers.includes(null)) {
                alert('Por favor responde todas las preguntas antes de enviar el examen.');
                return;
            }
            
            // Calculate score
            let correct = 0;
            examQuestions.forEach((q, index) => {
                if (examAnswers[index] === q.a) {
                    correct++;
                }
            });
            
            const percentage = (correct / examQuestions.length) * 100;
            const passed = percentage >= 70;
            
            // Save results
            Storage.saveFinalTestResults(MODULE_ID, correct, examQuestions.length, passed);
            
            // Award trophy if passed
            if (passed) {
                Storage.awardTrophy('angulos');
                Gamification.showTrophyToast('Experto en √Ångulos');
            }
            
            // Show results
            showExamResults(correct, examQuestions.length, percentage, passed);
        }

        function showExamResults(correct, total, percentage, passed) {
            document.getElementById('exam-questions').style.display = 'none';
            document.getElementById('exam-results').style.display = 'block';
            
            const title = document.getElementById('exam-score-title');
            const feedback = document.getElementById('exam-feedback');
            
            title.textContent = `Resultado: ${correct}/${total} (${percentage.toFixed(1)}%)`;
            
            if (passed) {
                feedback.innerHTML = `
                    <div class="result" style="background: rgba(78, 205, 196, 0.3);">
                        <h3>¬°Felicitaciones! üéâ</h3>
                        <p>Has aprobado el examen con ${percentage.toFixed(1)}%</p>
                        <p>üèÜ ¬°Has ganado el trofeo "Experto en √Ångulos"!</p>
                        <p>Dominas los √°ngulos perfectamente. ¬°Sigue as√≠!</p>
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="result" style="background: rgba(255, 107, 107, 0.3);">
                        <h3>Sigue practicando üí™</h3>
                        <p>Has obtenido ${percentage.toFixed(1)}%</p>
                        <p>Necesitas al menos 70% para aprobar.</p>
                        <p>Revisa la teor√≠a y vuelve a intentarlo. ¬°T√∫ puedes!</p>
                    </div>
                `;
            }
            
            updateExamStatus();
        }

        function updateExamStatus() {
            const testData = Storage.getFinalTestData(MODULE_ID);
            const statusDiv = document.getElementById('exam-status');
            
            if (testData && testData.passed) {
                statusDiv.innerHTML = `
                    <div class="result" style="background: rgba(78, 205, 196, 0.3);">
                        <h4>‚úÖ Examen Aprobado</h4>
                        <p>Puntuaci√≥n: ${((testData.score / testData.total) * 100).toFixed(1)}%</p>
                        <p>üèÜ Trofeo "Experto en √Ångulos" obtenido</p>
                    </div>
                `;
            } else if (testData) {
                statusDiv.innerHTML = `
                    <div class="result" style="background: rgba(255, 255, 255, 0.9);">
                        <h4>üìù √öltimo intento</h4>
                        <p>Puntuaci√≥n: ${((testData.score / testData.total) * 100).toFixed(1)}%</p>
                        <p>Intentos: ${testData.attempts}</p>
                    </div>
                `;
            }
        }

        // Add Enter key support
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab && activeTab.id === 'entrenamiento') {
                    const answer = document.getElementById('practice-answer').value;
                    if (answer && !questionAnswered) {
                        checkAnswer();
                    }
                }
            }
        });

        init();
    </script>
</body>
</html>
