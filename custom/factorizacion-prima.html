<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factorizaci√≥n Prima</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h1 {
            color: #f5576c;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            flex: 1;
            min-width: 180px;
            padding: 15px 25px;
            font-size: 1.1em;
            font-family: 'Comic Sans MS', cursive;
            background: white;
            border: 3px solid #f5576c;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tab-button.active {
            background: #f5576c;
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .explanation {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .prime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .prime-number {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .prime-number:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .composite-number {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .factorization-area {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .number-display {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .factor-tree {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border: 3px solid #f5576c;
        }

        .tree-level {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .tree-node {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .tree-node.prime {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border: 3px solid #e74c3c;
        }

        .tree-arrow {
            font-size: 2em;
            color: #f5576c;
            font-weight: bold;
        }

        .input-section {
            background: #e8f4f8;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
        }

        input[type="number"] {
            padding: 15px;
            font-size: 1.3em;
            border: 3px solid #f5576c;
            border-radius: 12px;
            font-family: 'Comic Sans MS', cursive;
            width: 200px;
            text-align: center;
        }

        button {
            padding: 15px 35px;
            font-size: 1.2em;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .result-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .factor-list {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
            font-size: 1.8em;
        }

        .factor-item {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: bold;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: popIn 0.3s;
        }

        @keyframes popIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .multiplication-sign {
            color: #f5576c;
            font-weight: bold;
            font-size: 1.5em;
        }

        .info-box {
            background: #d4edda;
            border: 3px solid #28a745;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .info-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #155724;
            margin-bottom: 10px;
        }

        .info-text {
            color: #155724;
            line-height: 1.6;
        }

        .steps-container {
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .step {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid #f5576c;
            font-size: 1.1em;
        }

        .step-number {
            background: #f5576c;
            color: white;
            padding: 5px 15px;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 10px;
        }

        .practice-question {
            background: #fff3cd;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 3px solid #ffc107;
        }

        .question-text {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .verification-box {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .number-display { font-size: 2em; }
            .tab-button { min-width: 140px; font-size: 1em; }
            .tree-node { font-size: 1.2em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üî¢ Factorizaci√≥n Prima</h1>
            <p class="subtitle">¬°Descomp√≥n n√∫meros en sus factores primos!</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('aprender')">üìö Aprender</button>
            <button class="tab-button" onclick="showTab('primos')">‚≠ê N√∫meros Primos</button>
            <button class="tab-button" onclick="showTab('factorizar')">üå≤ Factorizar</button>
            <button class="tab-button" onclick="showTab('componer')">‚ûï Componer</button>
            <button class="tab-button" onclick="showTab('practica')">üèÜ Pr√°ctica</button>
        </div>

        <!-- TAB 1: APRENDER -->
        <div id="aprender" class="tab-content active">
            <div class="explanation">
                <h2 class="content-header">üìñ ¬øQu√© es la Factorizaci√≥n Prima?</h2>
                <p><strong>Un n√∫mero primo</strong> es un n√∫mero mayor que 1 que solo se puede dividir exactamente por 1 y por s√≠ mismo.</p>
                <p class="spaced-paragraph"><strong>Factorizar</strong> un n√∫mero significa descomponerlo en una multiplicaci√≥n de n√∫meros primos.</p>
                <p class="spaced-paragraph">Por ejemplo: <strong>12 = 2 √ó 2 √ó 3</strong> (tambi√©n se escribe como 2¬≤ √ó 3)</p>
            </div>

            <h2 class="section-header-pink-colored">üåü Ejemplos Paso a Paso</h2>

            <div class="factorization-area">
                <h3 class="content-subheader">Ejemplo 1: Factorizar 24</h3>
                
                <div class="steps-container">
                    <div class="step">
                        <span class="step-number">1</span>
                        ¬ø24 es divisible por 2? S√≠ ‚Üí 24 √∑ 2 = <strong>12</strong>
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        ¬ø12 es divisible por 2? S√≠ ‚Üí 12 √∑ 2 = <strong>6</strong>
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        ¬ø6 es divisible por 2? S√≠ ‚Üí 6 √∑ 2 = <strong>3</strong>
                    </div>
                    <div class="step">
                        <span class="step-number">4</span>
                        3 es primo, ¬°terminamos!
                    </div>
                </div>

                <div class="result-box">
                    24 = 2 √ó 2 √ó 2 √ó 3 = 2¬≥ √ó 3
                </div>

                <div class="verification-box">
                    ‚úì Verificaci√≥n: 2 √ó 2 √ó 2 √ó 3 = 8 √ó 3 = 24 ‚úì
                </div>
            </div>

            <div class="factorization-area">
                <h3 class="content-subheader">Ejemplo 2: Factorizar 100</h3>
                
                <div class="factor-tree">
                    <div class="tree-level">
                        <div class="tree-node">100</div>
                    </div>
                    <div class="tree-level">
                        <span class="tree-arrow">‚Üô</span>
                        <span class="tree-arrow">‚Üò</span>
                    </div>
                    <div class="tree-level">
                        <div class="tree-node prime">2</div>
                        <span class="inline-separator">√ó</span>
                        <div class="tree-node">50</div>
                    </div>
                    <div class="tree-level tree-level-indent-sm">
                        <span class="tree-arrow">‚Üô</span>
                        <span class="tree-arrow">‚Üò</span>
                    </div>
                    <div class="tree-level tree-level-indent-sm">
                        <div class="tree-node prime">2</div>
                        <span class="inline-separator">√ó</span>
                        <div class="tree-node">25</div>
                    </div>
                    <div class="tree-level tree-level-indent-md">
                        <span class="tree-arrow">‚Üô</span>
                        <span class="tree-arrow">‚Üò</span>
                    </div>
                    <div class="tree-level tree-level-indent-md">
                        <div class="tree-node prime">5</div>
                        <span class="inline-separator">√ó</span>
                        <div class="tree-node prime">5</div>
                    </div>
                </div>

                <div class="result-box">
                    100 = 2 √ó 2 √ó 5 √ó 5 = 2¬≤ √ó 5¬≤
                </div>
            </div>

            <div class="info-box">
                <div class="info-title">üí° Datos Importantes:</div>
                <div class="info-text">
                    <p>‚úì Todos los n√∫meros se pueden descomponer en factores primos (excepto el 1)</p>
                    <p>‚úì La descomposici√≥n en primos es √∫nica para cada n√∫mero</p>
                    <p>‚úì Empezamos siempre por el primo m√°s peque√±o (2, 3, 5, 7, 11...)</p>
                    <p>‚úì Si un factor se repite, usamos potencias: 2 √ó 2 √ó 2 = 2¬≥</p>
                </div>
            </div>
        </div>

        <!-- TAB 2: N√öMEROS PRIMOS -->
        <div id="primos" class="tab-content">
            <div class="explanation">
                <h2 class="content-header">‚≠ê N√∫meros Primos del 1 al 100</h2>
                <p>Los n√∫meros primos solo se pueden dividir por 1 y por ellos mismos.</p>
                <p class="spaced-paragraph">Hay <strong>25 n√∫meros primos</strong> entre 1 y 100.</p>
            </div>

            <div class="prime-grid" id="primeGrid"></div>

            <div class="info-box">
                <div class="info-title">üéØ ¬øC√≥mo saber si un n√∫mero es primo?</div>
                <div class="info-text">
                    <p><strong>M√©todo r√°pido:</strong></p>
                    <p>1. Si termina en 0, 2, 4, 5, 6 u 8 ‚Üí NO es primo (excepto 2 y 5)</p>
                    <p>2. Si la suma de sus d√≠gitos es divisible por 3 ‚Üí NO es primo (excepto el 3)</p>
                    <p>3. Si no cumple ninguna regla, prueba dividir por los primos peque√±os (2, 3, 5, 7, 11...)</p>
                </div>
            </div>

            <div class="input-section">
                <h3 class="content-subheader-dark">üîç ¬øEs Primo?</h3>
                <div class="input-group">
                    <input type="number" id="primeCheck" placeholder="Introduce un n√∫mero" min="2" max="10000">
                    <button onclick="checkPrime()">Verificar</button>
                </div>
                <div id="primeResult"></div>
            </div>
        </div>

        <!-- TAB 3: FACTORIZAR -->
        <div id="factorizar" class="tab-content">
            <div class="explanation">
                <h2 class="content-header">üå≤ Factorizaci√≥n de N√∫meros</h2>
                <p>Introduce un n√∫mero y descubre su factorizaci√≥n prima completa.</p>
                <p class="spaced-paragraph">Ver√°s el √°rbol de factorizaci√≥n y todos los pasos.</p>
            </div>

            <div class="input-section">
                <div class="input-group">
                    <label class="large-label-text">N√∫mero a factorizar:</label>
                    <input type="number" id="factorizeInput" placeholder="Ej: 120" min="2" max="100000">
                    <button onclick="factorizeNumber()">Factorizar</button>
                </div>
            </div>

            <div id="factorizeResult"></div>
        </div>

        <!-- TAB 4: COMPONER -->
        <div id="componer" class="tab-content">
            <div class="explanation">
                <h2 class="content-header">‚ûï Componer desde Factores Primos</h2>
                <p>Multiplica factores primos para obtener el n√∫mero original.</p>
                <p class="spaced-paragraph">Por ejemplo: 2 √ó 2 √ó 3 √ó 5 = 60</p>
            </div>

            <div class="input-section">
                <h3 class="content-subheader-dark">Introduce los factores primos (separados por comas)</h3>
                <div class="input-group">
                    <input type="text" id="composeInput" placeholder="Ej: 2, 2, 3, 5" class="narrow-container">
                    <button onclick="composeFromFactors()">Componer</button>
                </div>
                <div id="composeResult"></div>
            </div>

            <div class="factorization-area">
                <h3 class="content-subheader">üìö Ejemplos para Probar:</h3>
                
                <div class="examples-grid">
                    <div class="info-box" style="cursor: pointer;" onclick="setComposeExample('2, 2, 3')">
                        <div class="info-title">2 √ó 2 √ó 3</div>
                        <div class="info-text">= 12</div>
                    </div>
                    <div class="info-box" style="cursor: pointer;" onclick="setComposeExample('2, 2, 2, 2')">
                        <div class="info-title">2 √ó 2 √ó 2 √ó 2</div>
                        <div class="info-text">= 16</div>
                    </div>
                    <div class="info-box" style="cursor: pointer;" onclick="setComposeExample('3, 3, 3')">
                        <div class="info-title">3 √ó 3 √ó 3</div>
                        <div class="info-text">= 27</div>
                    </div>
                    <div class="info-box" style="cursor: pointer;" onclick="setComposeExample('2, 3, 5, 7')">
                        <div class="info-title">2 √ó 3 √ó 5 √ó 7</div>
                        <div class="info-text">= 210</div>
                    </div>
                    <div class="info-box" style="cursor: pointer;" onclick="setComposeExample('11, 11')">
                        <div class="info-title">11 √ó 11</div>
                        <div class="info-text">= 121</div>
                    </div>
                    <div class="info-box" style="cursor: pointer;" onclick="setComposeExample('2, 2, 5, 5')">
                        <div class="info-title">2 √ó 2 √ó 5 √ó 5</div>
                        <div class="info-text">= 100</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: PR√ÅCTICA -->
        <div id="practica" class="tab-content">
            <div class="explanation">
                <h2 style="margin-bottom: 15px;">üèÜ ¬°Practica la Factorizaci√≥n!</h2>
                <p>Resuelve ejercicios de factorizaci√≥n prima y suma puntos.</p>
            </div>

            <div class="score">
                Puntuaci√≥n: <span id="score">0</span> puntos
            </div>
            
            <div class="score" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                Nivel: <span id="level">Principiante</span>
            </div>

            <div class="practice-question">
                <div class="question-text" id="questionText"></div>
                <div class="input-group">
                    <input type="text" id="answerInput" placeholder="Ej: 2, 2, 3" style="width: 300px;">
                    <button onclick="checkAnswer()">Comprobar</button>
                    <button onclick="nextQuestion()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Nueva Pregunta</button>
                </div>
                <div id="feedback" style="margin-top: 20px; font-size: 1.2em; font-weight: bold; text-align: center;"></div>
            </div>

            <div id="practiceExplanation"></div>
        </div>
    </div>

    <script>
        let currentTab = 'aprender';
        let score = 0;
        let currentQuestion = null;

        // Helper function to format numbers with space as thousand separator
        function formatNumber(num) {
            if (typeof num !== 'number') {
                num = parseFloat(num);
            }
            if (isNaN(num)) return '0';
            
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }

        // Helper function to parse input accepting both dot and comma as decimal separator
        function parseNumberInput(input) {
            if (typeof input === 'number') return input;
            // Replace comma with dot for decimal separator, remove spaces
            const cleaned = input.toString().replace(/\s/g, '').replace(',', '.');
            return parseFloat(cleaned);
        }

        // Generate prime grid
        function generatePrimeGrid() {
            const grid = document.getElementById('primeGrid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 100; i++) {
                const div = document.createElement('div');
                div.className = isPrime(i) ? 'prime-number' : 'prime-number composite-number';
                div.textContent = i;
                div.style.opacity = isPrime(i) ? '1' : '0.3';
                grid.appendChild(div);
            }
        }

        function isPrime(num) {
            if (num < 2) return false;
            if (num === 2) return true;
            if (num % 2 === 0) return false;
            
            for (let i = 3; i <= Math.sqrt(num); i += 2) {
                if (num % i === 0) return false;
            }
            return true;
        }

        function getPrimeFactors(n) {
            const factors = [];
            let num = n;
            
            for (let i = 2; i <= num; i++) {
                while (num % i === 0) {
                    factors.push(i);
                    num = num / i;
                }
            }
            
            return factors;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            currentTab = tabName;

            if (tabName === 'primos') {
                generatePrimeGrid();
            } else if (tabName === 'practica') {
                nextQuestion();
            }
        }

        function checkPrime() {
            const num = parseInt(document.getElementById('primeCheck').value);
            const resultDiv = document.getElementById('primeResult');
            
            if (isNaN(num) || num < 2) {
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: #f8d7da; color: #721c24;">
                        ‚ö†Ô∏è Por favor, introduce un n√∫mero mayor o igual a 2
                    </div>
                `;
                return;
            }
            
            const prime = isPrime(num);
            
            if (prime) {
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
                        ‚úÖ <strong>${num}</strong> es un n√∫mero PRIMO
                        <p style="margin-top: 10px; font-size: 0.8em;">Solo es divisible por 1 y ${num}</p>
                    </div>
                `;
            } else {
                const factors = getPrimeFactors(num);
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                        ‚ùå <strong>${num}</strong> NO es primo
                        <p style="margin-top: 10px; font-size: 0.8em;">Factorizaci√≥n: ${num} = ${factors.join(' √ó ')}</p>
                    </div>
                `;
            }
        }

        function factorizeNumber() {
            const num = parseInt(document.getElementById('factorizeInput').value);
            const resultDiv = document.getElementById('factorizeResult');
            
            if (isNaN(num) || num < 2) {
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: #f8d7da; color: #721c24;">
                        ‚ö†Ô∏è Por favor, introduce un n√∫mero mayor o igual a 2
                    </div>
                `;
                return;
            }

            if (num > 100000) {
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: #f8d7da; color: #721c24;">
                        ‚ö†Ô∏è Por favor, introduce un n√∫mero menor o igual a 100 000
                    </div>
                `;
                return;
            }

            const factors = getPrimeFactors(num);
            
            if (isPrime(num)) {
                resultDiv.innerHTML = `
                    <div class="factorization-area">
                        <div class="number-display">${num}</div>
                        <div class="result-box" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
                            ‚≠ê ¬°${num} es un n√∫mero PRIMO!
                            <p style="margin-top: 10px; font-size: 0.8em;">No se puede factorizar m√°s</p>
                        </div>
                    </div>
                `;
                return;
            }

            // Generate step-by-step division
            let steps = '';
            let tempNum = num;
            let stepNum = 1;
            
            for (const factor of factors) {
                steps += `
                    <div class="step">
                        <span class="step-number">${stepNum}</span>
                        ${tempNum} √∑ ${factor} = <strong>${tempNum / factor}</strong>
                    </div>
                `;
                tempNum = tempNum / factor;
                stepNum++;
            }

            // Count factor occurrences
            const factorCount = {};
            factors.forEach(f => {
                factorCount[f] = (factorCount[f] || 0) + 1;
            });

            // Create exponential form
            const expForm = Object.keys(factorCount).map(f => {
                return factorCount[f] > 1 ? `${f}^${factorCount[f]}` : f;
            }).join(' √ó ');

            resultDiv.innerHTML = `
                <div class="factorization-area">
                    <div class="number-display">${num}</div>
                    
                    <h3 style="color: #667eea; margin: 20px 0; text-align: center;">üìù Proceso de Divisi√≥n</h3>
                    <div class="steps-container">
                        ${steps}
                    </div>

                    <h3 style="color: #667eea; margin: 20px 0; text-align: center;">üéØ Factores Primos</h3>
                    <div class="factor-list">
                        ${factors.map(f => `<div class="factor-item">${f}</div>`).join('<span class="multiplication-sign">√ó</span>')}
                    </div>

                    <div class="result-box">
                        ${num} = ${factors.join(' √ó ')}
                        <p style="margin-top: 15px; font-size: 0.9em;">Forma exponencial: ${num} = ${expForm}</p>
                    </div>

                    <div class="verification-box">
                        ‚úì Verificaci√≥n: ${factors.join(' √ó ')} = ${factors.reduce((a, b) => a * b, 1)} ‚úì
                    </div>
                </div>
            `;
        }

        function composeFromFactors() {
            const input = document.getElementById('composeInput').value;
            const resultDiv = document.getElementById('composeResult');
            
            if (!input.trim()) {
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: #f8d7da; color: #721c24;">
                        ‚ö†Ô∏è Por favor, introduce los factores separados por comas
                    </div>
                `;
                return;
            }

            const factors = input.split(',').map(f => parseInt(f.trim())).filter(f => !isNaN(f) && f > 0);
            
            if (factors.length === 0) {
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: #f8d7da; color: #721c24;">
                        ‚ö†Ô∏è No se encontraron n√∫meros v√°lidos
                    </div>
                `;
                return;
            }

            // Check if all are prime
            const nonPrimes = factors.filter(f => !isPrime(f));
            
            if (nonPrimes.length > 0) {
                resultDiv.innerHTML = `
                    <div class="result-box" style="background: #fff3cd; color: #856404;">
                        ‚ö†Ô∏è Advertencia: Los siguientes n√∫meros NO son primos: ${nonPrimes.join(', ')}
                        <p style="margin-top: 10px; font-size: 0.8em;">La factorizaci√≥n solo usa n√∫meros primos</p>
                    </div>
                `;
            }

            const product = factors.reduce((a, b) => a * b, 1);

            resultDiv.innerHTML += `
                <div class="factorization-area">
                    <h3 style="color: #667eea; margin: 20px 0; text-align: center;">üéØ Multiplicaci√≥n</h3>
                    <div class="factor-list">
                        ${factors.map(f => `<div class="factor-item">${f}</div>`).join('<span class="multiplication-sign">√ó</span>')}
                    </div>

                    <div class="result-box">
                        ${factors.join(' √ó ')} = <span style="font-size: 1.3em;">${formatNumber(product)}</span>
                    </div>

                    <div class="verification-box">
                        El n√∫mero compuesto es: <strong style="font-size: 1.5em;">${formatNumber(product)}</strong>
                    </div>
                </div>
            `;
        }

        function setComposeExample(example) {
            document.getElementById('composeInput').value = example;
            composeFromFactors();
        }

        function nextQuestion() {
            const types = ['factorize', 'compose', 'identify'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('practiceExplanation').innerHTML = '';

            if (type === 'factorize') {
                const num = Math.floor(Math.random() * 200) + 10;
                currentQuestion = {
                    type: 'factorize',
                    number: num,
                    answer: getPrimeFactors(num)
                };
                document.getElementById('questionText').innerHTML = `
                    Factoriza el n√∫mero <strong style="color: #f5576c; font-size: 1.5em;">${num}</strong>
                    <p style="font-size: 0.8em; margin-top: 10px;">Escribe los factores primos separados por comas (Ej: 2, 2, 3)</p>
                `;
            } else if (type === 'compose') {
                const factors = generateRandomFactors();
                const product = factors.reduce((a, b) => a * b, 1);
                currentQuestion = {
                    type: 'compose',
                    factors: factors,
                    answer: product
                };
                document.getElementById('questionText').innerHTML = `
                    ¬øQu√© n√∫mero se obtiene multiplicando: <strong style="color: #f5576c; font-size: 1.3em;">${factors.join(' √ó ')}</strong>?
                    <p style="font-size: 0.8em; margin-top: 10px;">Escribe solo el n√∫mero</p>
                `;
            } else if (type === 'identify') {
                const num = Math.floor(Math.random() * 100) + 2;
                currentQuestion = {
                    type: 'identify',
                    number: num,
                    answer: isPrime(num)
                };
                document.getElementById('questionText').innerHTML = `
                    ¬øEl n√∫mero <strong style="color: #f5576c; font-size: 1.5em;">${num}</strong> es primo?
                    <p style="font-size: 0.8em; margin-top: 10px;">Responde: si o no</p>
                `;
            }
        }

        function generateRandomFactors() {
            const primes = [2, 3, 5, 7, 11, 13];
            const count = Math.floor(Math.random() * 3) + 2;
            const factors = [];
            
            for (let i = 0; i < count; i++) {
                factors.push(primes[Math.floor(Math.random() * primes.length)]);
            }
            
            return factors.sort((a, b) => a - b);
        }

        function updateScore() {
            let levelText = 'Principiante';
            
            if (score >= 150) {
                levelText = 'üåü Experto en Factorizaci√≥n';
            } else if (score >= 75) {
                levelText = '‚≠ê Estudiante Avanzado';
            } else if (score >= 30) {
                levelText = '‚ú® Buen Estudiante';
            }
            
            document.getElementById('level').textContent = levelText;
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim().toLowerCase();
            
            if (userAnswer === '') {
                document.getElementById('feedback').innerHTML = '<span style="color: #ff6b6b;">‚ö†Ô∏è Por favor, introduce una respuesta</span>';
                return;
            }

            let correct = false;

            if (currentQuestion.type === 'factorize') {
                const userFactors = userAnswer.split(',').map(f => parseInt(f.trim())).sort((a, b) => a - b);
                const correctFactors = currentQuestion.answer.sort((a, b) => a - b);
                correct = JSON.stringify(userFactors) === JSON.stringify(correctFactors);
                
                if (correct) {
                    score += 10;
                    document.getElementById('score').textContent = score;
                    updateScore();
                    document.getElementById('feedback').innerHTML = '<span style="color: #51cf66;">‚úÖ ¬°Correcto! +10 puntos</span>';
                    setTimeout(() => nextQuestion(), 2000);
                } else {
                    score = Math.max(0, score - 15);
                    document.getElementById('score').textContent = score;
                    updateScore();
                    document.getElementById('feedback').innerHTML = `<span style="color: #ff6b6b;">‚ùå Incorrecto. La respuesta correcta es: ${correctFactors.join(', ')} (-15 puntos)</span>`;
                    showFactorizationExplanation();
                }
            } else if (currentQuestion.type === 'compose') {
                const userNum = parseNumberInput(userAnswer);
                correct = userNum === currentQuestion.answer;
                
                if (correct) {
                    score += 10;
                    document.getElementById('score').textContent = score;
                    updateScore();
                    document.getElementById('feedback').innerHTML = '<span style="color: #51cf66;">‚úÖ ¬°Correcto! +10 puntos</span>';
                    setTimeout(() => nextQuestion(), 2000);
                } else {
                    score = Math.max(0, score - 15);
                    document.getElementById('score').textContent = score;
                    updateScore();
                    document.getElementById('feedback').innerHTML = `<span style="color: #ff6b6b;">‚ùå Incorrecto. La respuesta correcta es: ${formatNumber(currentQuestion.answer)} (-15 puntos)</span>`;
                }
            } else if (currentQuestion.type === 'identify') {
                correct = (userAnswer === 'si' && currentQuestion.answer) || (userAnswer === 'no' && !currentQuestion.answer);
                
                if (correct) {
                    score += 10;
                    document.getElementById('score').textContent = score;
                    updateScore();
                    document.getElementById('feedback').innerHTML = '<span style="color: #51cf66;">‚úÖ ¬°Correcto! +10 puntos</span>';
                    setTimeout(() => nextQuestion(), 2000);
                } else {
                    score = Math.max(0, score - 15);
                    document.getElementById('score').textContent = score;
                    updateScore();
                    const correctAnswer = currentQuestion.answer ? 'S√≠, es primo' : 'No, no es primo';
                    document.getElementById('feedback').innerHTML = `<span style="color: #ff6b6b;">‚ùå Incorrecto. ${correctAnswer} (-15 puntos)</span>`;
                    if (!currentQuestion.answer) {
                        showFactorizationExplanation();
                    }
                }
            }
        }

        function showFactorizationExplanation() {
            const factors = getPrimeFactors(currentQuestion.number);
            const html = `
                <div class="info-box" style="margin-top: 20px;">
                    <div class="info-title">üìñ Explicaci√≥n:</div>
                    <div class="info-text">
                        <p><strong>${currentQuestion.number}</strong> se factoriza como:</p>
                        <p style="font-size: 1.2em; margin: 10px 0;"><strong>${factors.join(' √ó ')}</strong></p>
                        <p>Verificaci√≥n: ${factors.join(' √ó ')} = ${factors.reduce((a, b) => a * b, 1)}</p>
                    </div>
                </div>
            `;
            document.getElementById('practiceExplanation').innerHTML = html;
        }

        // Initialize
        generatePrimeGrid();
        nextQuestion();
    </script>
</body>
</html>